// Since rev 454, only following revisions are added: 463,462,465,467+468,469,473
/********************************************************************************
 *                                                                              *
 * Author    :  Angus Johnson                                                   *
 * Version   :  6.1.4                                                           *
 * Date      :  6 February 2014                                                 *
 * Website   :  http://www.angusj.com                                           *
 * Copyright :  Angus Johnson 2010-2014                                         *
 *                                                                              *
 * License:                                                                     *
 * Use, modification & distribution is subject to Boost Software License Ver 1. *
 * http://www.boost.org/LICENSE_1_0.txt                                         *
 *                                                                              *
 * Attributions:                                                                *
 * The code in this library is an extension of Bala Vatti's clipping algorithm: *
 * "A generic solution to polygon clipping"                                     *
 * Communications of the ACM, Vol 35, Issue 7 (July 1992) pp 56-63.             *
 * http://portal.acm.org/citation.cfm?id=129906                                 *
 *                                                                              *
 * Computer graphics and geometric modeling: implementation and algorithms      *
 * By Max K. Agoston                                                            *
 * Springer; 1 edition (January 4, 2005)                                        *
 * http://books.google.com/books?q=vatti+clipping+agoston                       *
 *                                                                              *
 * See also:                                                                    *
 * "Polygon Offsetting by Computing Winding Numbers"                            *
 * Paper no. DETC2005-85513 pp. 565-575                                         *
 * ASME 2005 International Design Engineering Technical Conferences             *
 * and Computers and Information in Engineering Conference (IDETC/CIE2005)      *
 * September 24-28, 2005 , Long Beach, California, USA                          *
 * http://www.me.berkeley.edu/~mcmains/pubs/DAC05OffsetPolygon.pdf              *
 *                                                                              *
 *******************************************************************************/
/*******************************************************************************
 *                                                                              *
 * Author    :  Timo                                                            *
 * Version   :  6.1.3.2                                                         *
 * Date      :  1 February 2014                                                 *
 *                                                                              *
 * This is a translation of the C# Clipper library to Javascript.               *
 * Int128 struct of C# is implemented using JSBN of Tom Wu.                     *
 * Because Javascript lacks support for 64-bit integers, the space              *
 * is a little more restricted than in C# version.                              *
 *                                                                              *
 * C# version has support for coordinate space:                                 *
 * +-4611686018427387903 ( sqrt(2^127 -1)/2 )                                   *
 * while Javascript version has support for space:                              *
 * +-4503599627370495 ( sqrt(2^106 -1)/2 )                                      *
 *                                                                              *
 * Tom Wu's JSBN proved to be the fastest big integer library:                  *
 * http://jsperf.com/big-integer-library-test                                   *
 *                                                                              *
 * This class can be made simpler when (if ever) 64-bit integer support comes.  *
 *                                                                              *
 *******************************************************************************/
/*******************************************************************************
 *                                                                              *
 * Basic JavaScript BN library - subset useful for RSA encryption.              *
 * http://www-cs-students.stanford.edu/~tjw/jsbn/                               *
 * Copyright (c) 2005  Tom Wu                                                   *
 * All Rights Reserved.                                                         *
 * See "LICENSE" for details:                                                   *
 * http://www-cs-students.stanford.edu/~tjw/jsbn/LICENSE                        *
 *                                                                              *
 *******************************************************************************/
/*******************************************************************************
 *                                                                              *
 * Author    :  Ruwan Janapriya Egoda Gamage                                    *
 * Version   :  6.1.5                                                           *
 * Date      :  19 September 15                                                 *
 *                                                                              *
 * Starting from 6.1.3.2, I'm porting latest changes from the C# lib to         *
 * jsClipper                                                                    *
 *******************************************************************************/
(function(){var J=false;var av=false;var P=true;var aV=false;var ar={};var au=false;if(typeof module!=="undefined"&&module.exports){module.exports=ar;au=true}else{if(typeof(document)!=="undefined"){window.ClipperLib=ar}else{self.ClipperLib=ar}}var L;if(!au){var y=navigator.userAgent.toString().toLowerCase();L=navigator.appName}else{var y="chrome";L="Netscape"}var a2={};if(y.indexOf("chrome")!=-1&&y.indexOf("chromium")==-1){a2.chrome=1}else{a2.chrome=0}if(y.indexOf("chromium")!=-1){a2.chromium=1}else{a2.chromium=0}if(y.indexOf("safari")!=-1&&y.indexOf("chrome")==-1&&y.indexOf("chromium")==-1){a2.safari=1}else{a2.safari=0}if(y.indexOf("firefox")!=-1){a2.firefox=1}else{a2.firefox=0}if(y.indexOf("firefox/17")!=-1){a2.firefox17=1}else{a2.firefox17=0}if(y.indexOf("firefox/15")!=-1){a2.firefox15=1}else{a2.firefox15=0}if(y.indexOf("firefox/3")!=-1){a2.firefox3=1}else{a2.firefox3=0}if(y.indexOf("opera")!=-1){a2.opera=1}else{a2.opera=0}if(y.indexOf("msie 10")!=-1){a2.msie10=1}else{a2.msie10=0}if(y.indexOf("msie 9")!=-1){a2.msie9=1}else{a2.msie9=0}if(y.indexOf("msie 8")!=-1){a2.msie8=1}else{a2.msie8=0}if(y.indexOf("msie 7")!=-1){a2.msie7=1}else{a2.msie7=0}if(y.indexOf("msie ")!=-1){a2.msie=1}else{a2.msie=0}ar.biginteger_used=null;var bo;var a3=244837814094590;var aN=((a3&16777215)==15715070);function bc(bt,bs,bu){ar.biginteger_used=1;if(bt!=null){if("number"==typeof bt&&"undefined"==typeof(bs)){this.fromInt(bt)}else{if("number"==typeof bt){this.fromNumber(bt,bs,bu)}else{if(bs==null&&"string"!=typeof bt){this.fromString(bt,256)}else{this.fromString(bt,bs)}}}}}function m(){return new bc(null)}function a(bw,bs,bt,bv,by,bx){while(--bx>=0){var bu=bs*this[bw++]+bt[bv]+by;by=Math.floor(bu/67108864);bt[bv++]=bu&67108863}return by}function bq(bw,bB,bC,bv,bz,bs){var by=bB&32767,bA=bB>>15;while(--bs>=0){var bu=this[bw]&32767;var bx=this[bw++]>>15;var bt=bA*bu+bx*by;bu=by*bu+((bt&32767)<<15)+bC[bv]+(bz&1073741823);bz=(bu>>>30)+(bt>>>15)+bA*bx+(bz>>>30);bC[bv++]=bu&1073741823}return bz}function bp(bw,bB,bC,bv,bz,bs){var by=bB&16383,bA=bB>>14;while(--bs>=0){var bu=this[bw]&16383;var bx=this[bw++]>>14;var bt=bA*bu+bx*by;bu=by*bu+((bt&16383)<<14)+bC[bv]+bz;bz=(bu>>28)+(bt>>14)+bA*bx;bC[bv++]=bu&268435455}return bz}if(aN&&(L=="Microsoft Internet Explorer")){bc.prototype.am=bq;bo=30}else{if(aN&&(L!="Netscape")){bc.prototype.am=a;bo=26}else{bc.prototype.am=bp;bo=28}}bc.prototype.DB=bo;bc.prototype.DM=((1<<bo)-1);bc.prototype.DV=(1<<bo);var aP=52;bc.prototype.FV=Math.pow(2,aP);bc.prototype.F1=aP-bo;bc.prototype.F2=2*bo-aP;var aY="0123456789abcdefghijklmnopqrstuvwxyz";var a1=new Array();var ba,C;ba="0".charCodeAt(0);for(C=0;C<=9;++C){a1[ba++]=C}ba="a".charCodeAt(0);for(C=10;C<36;++C){a1[ba++]=C}ba="A".charCodeAt(0);for(C=10;C<36;++C){a1[ba++]=C}function br(bs){return aY.charAt(bs)}function O(bt,bs){var bu=a1[bt.charCodeAt(bs)];return(bu==null)?-1:bu}function aM(bt){for(var bs=this.t-1;bs>=0;--bs){bt[bs]=this[bs]}bt.t=this.t;bt.s=this.s}function v(bs){this.t=1;this.s=(bs<0)?-1:0;if(bs>0){this[0]=bs}else{if(bs<-1){this[0]=bs+this.DV}else{this.t=0}}}function d(bs){var bt=m();bt.fromInt(bs);return bt}function F(by,bt){var bv;if(bt==16){bv=4}else{if(bt==8){bv=3}else{if(bt==256){bv=8}else{if(bt==2){bv=1}else{if(bt==32){bv=5}else{if(bt==4){bv=2}else{this.fromRadix(by,bt);return}}}}}}this.t=0;this.s=0;var bx=by.length,bu=false,bw=0;while(--bx>=0){var bs=(bv==8)?by[bx]&255:O(by,bx);if(bs<0){if(by.charAt(bx)=="-"){bu=true}continue}bu=false;if(bw==0){this[this.t++]=bs}else{if(bw+bv>this.DB){this[this.t-1]|=(bs&((1<<(this.DB-bw))-1))<<bw;this[this.t++]=(bs>>(this.DB-bw))}else{this[this.t-1]|=bs<<bw}}bw+=bv;if(bw>=this.DB){bw-=this.DB}}if(bv==8&&(by[0]&128)!=0){this.s=-1;if(bw>0){this[this.t-1]|=((1<<(this.DB-bw))-1)<<bw}}this.clamp();if(bu){bc.ZERO.subTo(this,this)}}function an(){var bs=this.s&this.DM;while(this.t>0&&this[this.t-1]==bs){--this.t}}function x(bt){if(this.s<0){return"-"+this.negate().toString(bt)}var bu;if(bt==16){bu=4}else{if(bt==8){bu=3}else{if(bt==2){bu=1}else{if(bt==32){bu=5}else{if(bt==4){bu=2}else{return this.toRadix(bt)}}}}}var bw=(1<<bu)-1,bz,bs=false,bx="",bv=this.t;var by=this.DB-(bv*this.DB)%bu;if(bv-->0){if(by<this.DB&&(bz=this[bv]>>by)>0){bs=true;bx=br(bz)}while(bv>=0){if(by<bu){bz=(this[bv]&((1<<by)-1))<<(bu-by);bz|=this[--bv]>>(by+=this.DB-bu)}else{bz=(this[bv]>>(by-=bu))&bw;if(by<=0){by+=this.DB;--bv}}if(bz>0){bs=true}if(bs){bx+=br(bz)}}}return bs?bx:"0"}function at(){var bs=m();bc.ZERO.subTo(this,bs);return bs}function a6(){return(this.s<0)?this.negate():this}function Z(bs){var bu=this.s-bs.s;if(bu!=0){return bu}var bt=this.t;bu=bt-bs.t;if(bu!=0){return(this.s<0)?-bu:bu}while(--bt>=0){if((bu=this[bt]-bs[bt])!=0){return bu}}return 0}function r(bs){var bu=1,bt;if((bt=bs>>>16)!=0){bs=bt;bu+=16}if((bt=bs>>8)!=0){bs=bt;bu+=8}if((bt=bs>>4)!=0){bs=bt;bu+=4}if((bt=bs>>2)!=0){bs=bt;bu+=2}if((bt=bs>>1)!=0){bs=bt;bu+=1}return bu}function B(){if(this.t<=0){return 0}return this.DB*(this.t-1)+r(this[this.t-1]^(this.s&this.DM))}function bb(bu,bt){var bs;for(bs=this.t-1;bs>=0;--bs){bt[bs+bu]=this[bs]}for(bs=bu-1;bs>=0;--bs){bt[bs]=0}bt.t=this.t+bu;bt.s=this.s}function aL(bu,bt){for(var bs=bu;bs<this.t;++bs){bt[bs-bu]=this[bs]}bt.t=Math.max(this.t-bu,0);bt.s=this.s}function A(bA,bw){var bu=bA%this.DB;var bt=this.DB-bu;var by=(1<<bt)-1;var bx=Math.floor(bA/this.DB),bz=(this.s<<bu)&this.DM,bv;for(bv=this.t-1;bv>=0;--bv){bw[bv+bx+1]=(this[bv]>>bt)|bz;bz=(this[bv]&by)<<bu}for(bv=bx-1;bv>=0;--bv){bw[bv]=0}bw[bx]=bz;bw.t=this.t+bx+1;bw.s=this.s;bw.clamp()}function s(bz,bw){bw.s=this.s;var bx=Math.floor(bz/this.DB);if(bx>=this.t){bw.t=0;return}var bu=bz%this.DB;var bt=this.DB-bu;var by=(1<<bu)-1;bw[0]=this[bx]>>bu;for(var bv=bx+1;bv<this.t;++bv){bw[bv-bx-1]|=(this[bv]&by)<<bt;bw[bv-bx]=this[bv]>>bu}if(bu>0){bw[this.t-bx-1]|=(this.s&by)<<bt}bw.t=this.t-bx;bw.clamp()}function aQ(bt,bv){var bu=0,bw=0,bs=Math.min(bt.t,this.t);while(bu<bs){bw+=this[bu]-bt[bu];bv[bu++]=bw&this.DM;bw>>=this.DB}if(bt.t<this.t){bw-=bt.s;while(bu<this.t){bw+=this[bu];bv[bu++]=bw&this.DM;bw>>=this.DB}bw+=this.s}else{bw+=this.s;while(bu<bt.t){bw-=bt[bu];bv[bu++]=bw&this.DM;bw>>=this.DB}bw-=bt.s}bv.s=(bw<0)?-1:0;if(bw<-1){bv[bu++]=this.DV+bw}else{if(bw>0){bv[bu++]=bw}}bv.t=bu;bv.clamp()}function U(bt,bv){var bs=this.abs(),bw=bt.abs();var bu=bs.t;bv.t=bu+bw.t;while(--bu>=0){bv[bu]=0}for(bu=0;bu<bw.t;++bu){bv[bu+bs.t]=bs.am(0,bw[bu],bv,bu,0,bs.t)}bv.s=0;bv.clamp();if(this.s!=bt.s){bc.ZERO.subTo(bv,bv)}}function ap(bu){var bs=this.abs();var bt=bu.t=2*bs.t;while(--bt>=0){bu[bt]=0}for(bt=0;bt<bs.t-1;++bt){var bv=bs.am(bt,bs[bt],bu,2*bt,0,1);if((bu[bt+bs.t]+=bs.am(bt+1,2*bs[bt],bu,2*bt+1,bv,bs.t-bt-1))>=bs.DV){bu[bt+bs.t]-=bs.DV;bu[bt+bs.t+1]=1}}if(bu.t>0){bu[bu.t-1]+=bs.am(bt,bs[bt],bu,2*bt,0,1)}bu.s=0;bu.clamp()}function V(bB,by,bx){var bH=bB.abs();if(bH.t<=0){return}var bz=this.abs();if(bz.t<bH.t){if(by!=null){by.fromInt(0)}if(bx!=null){this.copyTo(bx)}return}if(bx==null){bx=m()}var bv=m(),bs=this.s,bA=bB.s;var bG=this.DB-r(bH[bH.t-1]);if(bG>0){bH.lShiftTo(bG,bv);bz.lShiftTo(bG,bx)}else{bH.copyTo(bv);bz.copyTo(bx)}var bD=bv.t;var bt=bv[bD-1];if(bt==0){return}var bC=bt*(1<<this.F1)+((bD>1)?bv[bD-2]>>this.F2:0);var bK=this.FV/bC,bJ=(1<<this.F1)/bC,bI=1<<this.F2;var bF=bx.t,bE=bF-bD,bw=(by==null)?m():by;bv.dlShiftTo(bE,bw);if(bx.compareTo(bw)>=0){bx[bx.t++]=1;bx.subTo(bw,bx)}bc.ONE.dlShiftTo(bD,bw);bw.subTo(bv,bv);while(bv.t<bD){bv[bv.t++]=0}while(--bE>=0){var bu=(bx[--bF]==bt)?this.DM:Math.floor(bx[bF]*bK+(bx[bF-1]+bI)*bJ);if((bx[bF]+=bv.am(0,bu,bx,bE,0,bD))<bu){bv.dlShiftTo(bE,bw);bx.subTo(bw,bx);while(bx[bF]<--bu){bx.subTo(bw,bx)}}}if(by!=null){bx.drShiftTo(bD,by);if(bs!=bA){bc.ZERO.subTo(by,by)}}bx.t=bD;bx.clamp();if(bG>0){bx.rShiftTo(bG,bx)}if(bs<0){bc.ZERO.subTo(bx,bx)}}function am(bs){var bt=m();this.abs().divRemTo(bs,null,bt);if(this.s<0&&bt.compareTo(bc.ZERO)>0){bs.subTo(bt,bt)}return bt}function ad(bs){this.m=bs}function aH(bs){if(bs.s<0||bs.compareTo(this.m)>=0){return bs.mod(this.m)}else{return bs}}function a5(bs){return bs}function ab(bs){bs.divRemTo(this.m,null,bs)}function aa(bs,bu,bt){bs.multiplyTo(bu,bt);this.reduce(bt)}function bh(bs,bt){bs.squareTo(bt);this.reduce(bt)}ad.prototype.convert=aH;ad.prototype.revert=a5;ad.prototype.reduce=ab;ad.prototype.mulTo=aa;ad.prototype.sqrTo=bh;function R(){if(this.t<1){return 0}var bs=this[0];if((bs&1)==0){return 0}var bt=bs&3;bt=(bt*(2-(bs&15)*bt))&15;bt=(bt*(2-(bs&255)*bt))&255;bt=(bt*(2-(((bs&65535)*bt)&65535)))&65535;bt=(bt*(2-bs*bt%this.DV))%this.DV;return(bt>0)?this.DV-bt:-bt}function h(bs){this.m=bs;this.mp=bs.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<(bs.DB-15))-1;this.mt2=2*bs.t}function a4(bs){var bt=m();bs.abs().dlShiftTo(this.m.t,bt);bt.divRemTo(this.m,null,bt);if(bs.s<0&&bt.compareTo(bc.ZERO)>0){this.m.subTo(bt,bt)}return bt}function bf(bs){var bt=m();bs.copyTo(bt);this.reduce(bt);return bt}function ao(bs){while(bs.t<=this.mt2){bs[bs.t++]=0}for(var bu=0;bu<this.m.t;++bu){var bt=bs[bu]&32767;var bv=(bt*this.mpl+(((bt*this.mph+(bs[bu]>>15)*this.mpl)&this.um)<<15))&bs.DM;bt=bu+this.m.t;bs[bt]+=this.m.am(0,bv,bs,bu,0,this.m.t);while(bs[bt]>=bs.DV){bs[bt]-=bs.DV;bs[++bt]++}}bs.clamp();bs.drShiftTo(this.m.t,bs);if(bs.compareTo(this.m)>=0){bs.subTo(this.m,bs)}}function a7(bs,bt){bs.squareTo(bt);this.reduce(bt)}function N(bs,bu,bt){bs.multiplyTo(bu,bt);this.reduce(bt)}h.prototype.convert=a4;h.prototype.revert=bf;h.prototype.reduce=ao;h.prototype.mulTo=N;h.prototype.sqrTo=a7;function n(){return((this.t>0)?(this[0]&1):this.s)==0}function G(bx,by){if(bx>4294967295||bx<1){return bc.ONE}var bw=m(),bs=m(),bv=by.convert(this),bu=r(bx)-1;bv.copyTo(bw);while(--bu>=0){by.sqrTo(bw,bs);if((bx&(1<<bu))>0){by.mulTo(bs,bv,bw)}else{var bt=bw;bw=bs;bs=bt}}return by.revert(bw)}function a9(bt,bs){var bu;if(bt<256||bs.isEven()){bu=new ad(bs)}else{bu=new h(bs)}return this.exp(bt,bu)}bc.prototype.copyTo=aM;bc.prototype.fromInt=v;bc.prototype.fromString=F;bc.prototype.clamp=an;bc.prototype.dlShiftTo=bb;bc.prototype.drShiftTo=aL;bc.prototype.lShiftTo=A;bc.prototype.rShiftTo=s;bc.prototype.subTo=aQ;bc.prototype.multiplyTo=U;bc.prototype.squareTo=ap;bc.prototype.divRemTo=V;bc.prototype.invDigit=R;bc.prototype.isEven=n;bc.prototype.exp=G;bc.prototype.toString=x;bc.prototype.negate=at;bc.prototype.abs=a6;bc.prototype.compareTo=Z;bc.prototype.bitLength=B;bc.prototype.mod=am;bc.prototype.modPowInt=a9;bc.ZERO=d(0);bc.ONE=d(1);function k(){var bs=m();this.copyTo(bs);return bs}function X(){if(this.s<0){if(this.t==1){return this[0]-this.DV}else{if(this.t==0){return -1}}}else{if(this.t==1){return this[0]}else{if(this.t==0){return 0}}}return((this[1]&((1<<(32-this.DB))-1))<<this.DB)|this[0]}function aZ(){return(this.t==0)?this.s:(this[0]<<24)>>24}function aq(){return(this.t==0)?this.s:(this[0]<<16)>>16}function aK(bs){return Math.floor(Math.LN2*this.DB/Math.log(bs))}function bd(){if(this.s<0){return -1}else{if(this.t<=0||(this.t==1&&this[0]<=0)){return 0}else{return 1}}}function K(bs){if(bs==null){bs=10}if(this.signum()==0||bs<2||bs>36){return"0"}var bu=this.chunkSize(bs);var bt=Math.pow(bs,bu);var bx=d(bt),by=m(),bw=m(),bv="";this.divRemTo(bx,by,bw);while(by.signum()>0){bv=(bt+bw.intValue()).toString(bs).substr(1)+bv;by.divRemTo(bx,by,bw)}return bw.intValue().toString(bs)+bv}function aB(bA,bx){this.fromInt(0);if(bx==null){bx=10}var bv=this.chunkSize(bx);var bw=Math.pow(bx,bv),bu=false,bs=0,bz=0;for(var bt=0;bt<bA.length;++bt){var by=O(bA,bt);if(by<0){if(bA.charAt(bt)=="-"&&this.signum()==0){bu=true}continue}bz=bx*bz+by;if(++bs>=bv){this.dMultiply(bw);this.dAddOffset(bz,0);bs=0;bz=0}}if(bs>0){this.dMultiply(Math.pow(bx,bs));this.dAddOffset(bz,0)}if(bu){bc.ZERO.subTo(this,this)}}function aX(bu,bt,bw){if("number"==typeof bt){if(bu<2){this.fromInt(1)}else{this.fromNumber(bu,bw);if(!this.testBit(bu-1)){this.bitwiseTo(bc.ONE.shiftLeft(bu-1),af,this)}if(this.isEven()){this.dAddOffset(1,0)}while(!this.isProbablePrime(bt)){this.dAddOffset(2,0);if(this.bitLength()>bu){this.subTo(bc.ONE.shiftLeft(bu-1),this)}}}}else{var bs=new Array(),bv=bu&7;bs.length=(bu>>3)+1;bt.nextBytes(bs);if(bv>0){bs[0]&=((1<<bv)-1)}else{bs[0]=0}this.fromString(bs,256)}}function bl(){var bt=this.t,bu=new Array();bu[0]=this.s;var bv=this.DB-(bt*this.DB)%8,bw,bs=0;if(bt-->0){if(bv<this.DB&&(bw=this[bt]>>bv)!=(this.s&this.DM)>>bv){bu[bs++]=bw|(this.s<<(this.DB-bv))}while(bt>=0){if(bv<8){bw=(this[bt]&((1<<bv)-1))<<(8-bv);bw|=this[--bt]>>(bv+=this.DB-8)}else{bw=(this[bt]>>(bv-=8))&255;if(bv<=0){bv+=this.DB;--bt}}if((bw&128)!=0){bw|=-256}if(bs==0&&(this.s&128)!=(bw&128)){++bs}if(bs>0||bw!=this.s){bu[bs++]=bw}}}return bu}function ax(bs){return(this.compareTo(bs)==0)}function Y(bs){return(this.compareTo(bs)<0)?this:bs}function aF(bs){return(this.compareTo(bs)>0)?this:bs}function aW(bt,bx,bv){var bu,bw,bs=Math.min(bt.t,this.t);for(bu=0;bu<bs;++bu){bv[bu]=bx(this[bu],bt[bu])}if(bt.t<this.t){bw=bt.s&this.DM;for(bu=bs;bu<this.t;++bu){bv[bu]=bx(this[bu],bw)}bv.t=this.t}else{bw=this.s&this.DM;for(bu=bs;bu<bt.t;++bu){bv[bu]=bx(bw,bt[bu])}bv.t=bt.t}bv.s=bx(this.s,bt.s);bv.clamp()}function M(bs,bt){return bs&bt}function bn(bs){var bt=m();this.bitwiseTo(bs,M,bt);return bt}function af(bs,bt){return bs|bt}function aJ(bs){var bt=m();this.bitwiseTo(bs,af,bt);return bt}function S(bs,bt){return bs^bt}function f(bs){var bt=m();this.bitwiseTo(bs,S,bt);return bt}function D(bs,bt){return bs&~bt}function t(bs){var bt=m();this.bitwiseTo(bs,D,bt);return bt}function T(){var bt=m();for(var bs=0;bs<this.t;++bs){bt[bs]=this.DM&~this[bs]}bt.t=this.t;bt.s=~this.s;return bt}function E(bt){var bs=m();if(bt<0){this.rShiftTo(-bt,bs)}else{this.lShiftTo(bt,bs)}return bs}function bm(bt){var bs=m();if(bt<0){this.lShiftTo(-bt,bs)}else{this.rShiftTo(bt,bs)}return bs}function p(bs){if(bs==0){return -1}var bt=0;if((bs&65535)==0){bs>>=16;bt+=16}if((bs&255)==0){bs>>=8;bt+=8}if((bs&15)==0){bs>>=4;bt+=4}if((bs&3)==0){bs>>=2;bt+=2}if((bs&1)==0){++bt}return bt}function w(){for(var bs=0;bs<this.t;++bs){if(this[bs]!=0){return bs*this.DB+p(this[bs])}}if(this.s<0){return this.t*this.DB}return -1}function a8(bs){var bt=0;while(bs!=0){bs&=bs-1;++bt}return bt}function aU(){var bu=0,bs=this.s&this.DM;for(var bt=0;bt<this.t;++bt){bu+=a8(this[bt]^bs)}return bu}function aS(bt){var bs=Math.floor(bt/this.DB);if(bs>=this.t){return(this.s!=0)}return((this[bs]&(1<<(bt%this.DB)))!=0)}function W(bu,bt){var bs=bc.ONE.shiftLeft(bu);this.bitwiseTo(bs,bt,bs);return bs}function Q(bs){return this.changeBit(bs,af)}function u(bs){return this.changeBit(bs,D)}function c(bs){return this.changeBit(bs,S)}function aC(bt,bv){var bu=0,bw=0,bs=Math.min(bt.t,this.t);while(bu<bs){bw+=this[bu]+bt[bu];bv[bu++]=bw&this.DM;bw>>=this.DB}if(bt.t<this.t){bw+=bt.s;while(bu<this.t){bw+=this[bu];bv[bu++]=bw&this.DM;bw>>=this.DB}bw+=this.s}else{bw+=this.s;while(bu<bt.t){bw+=bt[bu];bv[bu++]=bw&this.DM;bw>>=this.DB}bw+=bt.s}bv.s=(bw<0)?-1:0;if(bw>0){bv[bu++]=bw}else{if(bw<-1){bv[bu++]=this.DV+bw}}bv.t=bu;bv.clamp()}function aE(bs){var bt=m();this.addTo(bs,bt);return bt}function be(bs){var bt=m();this.subTo(bs,bt);return bt}function aw(bs){var bt=m();this.multiplyTo(bs,bt);return bt}function aR(){var bs=m();this.squareTo(bs);return bs}function e(bs){var bt=m();this.divRemTo(bs,bt,null);return bt}function j(bs){var bt=m();this.divRemTo(bs,null,bt);return bt}function aT(bs){var bu=m(),bt=m();this.divRemTo(bs,bu,bt);return new Array(bu,bt)}function o(bs){this[this.t]=this.am(0,bs-1,this,0,0,this.t);++this.t;this.clamp()}function al(bt,bs){if(bt==0){return}while(this.t<=bs){this[this.t++]=0}this[bs]+=bt;while(this[bs]>=this.DV){this[bs]-=this.DV;if(++bs>=this.t){this[this.t++]=0}++this[bs]}}function aD(){}function a0(bs){return bs}function q(bs,bu,bt){bs.multiplyTo(bu,bt)}function aI(bs,bt){bs.squareTo(bt)}aD.prototype.convert=a0;aD.prototype.revert=a0;aD.prototype.mulTo=q;aD.prototype.sqrTo=aI;function H(bs){return this.exp(bs,new aD())}function l(bs,bw,bv){var bu=Math.min(this.t+bs.t,bw);bv.s=0;bv.t=bu;while(bu>0){bv[--bu]=0}var bt;for(bt=bv.t-this.t;bu<bt;++bu){bv[bu+this.t]=this.am(0,bs[bu],bv,bu,0,this.t)}for(bt=Math.min(bs.t,bw);bu<bt;++bu){this.am(0,bs[bu],bv,bu,0,bw-bu)}bv.clamp()}function g(bs,bv,bu){--bv;var bt=bu.t=this.t+bs.t-bv;bu.s=0;while(--bt>=0){bu[bt]=0}for(bt=Math.max(bv-this.t,0);bt<bs.t;++bt){bu[this.t+bt-bv]=this.am(bv-bt,bs[bt],bu,0,0,this.t+bt-bv)}bu.clamp();bu.drShiftTo(1,bu)}function I(bs){this.r2=m();this.q3=m();bc.ONE.dlShiftTo(2*bs.t,this.r2);this.mu=this.r2.divide(bs);this.m=bs}function ac(bs){if(bs.s<0||bs.t>2*this.m.t){return bs.mod(this.m)}else{if(bs.compareTo(this.m)<0){return bs}else{var bt=m();bs.copyTo(bt);this.reduce(bt);return bt}}}function ah(bs){return bs}function bi(bs){bs.drShiftTo(this.m.t-1,this.r2);if(bs.t>this.m.t+1){bs.t=this.m.t+1;bs.clamp()}this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(bs.compareTo(this.r2)<0){bs.dAddOffset(1,this.m.t+1)}bs.subTo(this.r2,bs);while(bs.compareTo(this.m)>=0){bs.subTo(this.m,bs)}}function ay(bs,bt){bs.squareTo(bt);this.reduce(bt)}function bk(bs,bu,bt){bs.multiplyTo(bu,bt);this.reduce(bt)}I.prototype.convert=ac;I.prototype.revert=ah;I.prototype.reduce=bi;I.prototype.mulTo=bk;I.prototype.sqrTo=ay;function aG(bB,bw){var bz=bB.bitLength(),bx,bt=d(1),bE;if(bz<=0){return bt}else{if(bz<18){bx=1}else{if(bz<48){bx=3}else{if(bz<144){bx=4}else{if(bz<768){bx=5}else{bx=6}}}}}if(bz<8){bE=new ad(bw)}else{if(bw.isEven()){bE=new I(bw)}else{bE=new h(bw)}}var bA=new Array(),bv=3,bC=bx-1,bs=(1<<bx)-1;bA[1]=bE.convert(this);if(bx>1){var bH=m();bE.sqrTo(bA[1],bH);while(bv<=bs){bA[bv]=m();bE.mulTo(bH,bA[bv-2],bA[bv]);bv+=2}}var by=bB.t-1,bF,bD=true,bu=m(),bG;bz=r(bB[by])-1;while(by>=0){if(bz>=bC){bF=(bB[by]>>(bz-bC))&bs}else{bF=(bB[by]&((1<<(bz+1))-1))<<(bC-bz);if(by>0){bF|=bB[by-1]>>(this.DB+bz-bC)}}bv=bx;while((bF&1)==0){bF>>=1;--bv}if((bz-=bv)<0){bz+=this.DB;--by}if(bD){bA[bF].copyTo(bt);bD=false}else{while(bv>1){bE.sqrTo(bt,bu);bE.sqrTo(bu,bt);bv-=2}if(bv>0){bE.sqrTo(bt,bu)}else{bG=bt;bt=bu;bu=bG}bE.mulTo(bu,bA[bF],bt)}while(by>=0&&(bB[by]&(1<<bz))==0){bE.sqrTo(bt,bu);bG=bt;bt=bu;bu=bG;if(--bz<0){bz=this.DB-1;--by}}}return bE.revert(bt)}function bg(bt){var bs=(this.s<0)?this.negate():this.clone();var bx=(bt.s<0)?bt.negate():bt.clone();if(bs.compareTo(bx)<0){var bv=bs;bs=bx;bx=bv}var bu=bs.getLowestSetBit(),bw=bx.getLowestSetBit();if(bw<0){return bs}if(bu<bw){bw=bu}if(bw>0){bs.rShiftTo(bw,bs);bx.rShiftTo(bw,bx)}while(bs.signum()>0){if((bu=bs.getLowestSetBit())>0){bs.rShiftTo(bu,bs)}if((bu=bx.getLowestSetBit())>0){bx.rShiftTo(bu,bx)}if(bs.compareTo(bx)>=0){bs.subTo(bx,bs);bs.rShiftTo(1,bs)}else{bx.subTo(bs,bx);bx.rShiftTo(1,bx)}}if(bw>0){bx.lShiftTo(bw,bx)}return bx}function z(bv){if(bv<=0){return 0}var bu=this.DV%bv,bt=(this.s<0)?bv-1:0;if(this.t>0){if(bu==0){bt=this[0]%bv}else{for(var bs=this.t-1;bs>=0;--bs){bt=(bu*bt+this[bs])%bv}}}return bt}function b(bt){var bx=bt.isEven();if((this.isEven()&&bx)||bt.signum()==0){return bc.ZERO}var bw=bt.clone(),bv=this.clone();var bu=d(1),bs=d(0),bz=d(0),by=d(1);while(bw.signum()!=0){while(bw.isEven()){bw.rShiftTo(1,bw);if(bx){if(!bu.isEven()||!bs.isEven()){bu.addTo(this,bu);bs.subTo(bt,bs)}bu.rShiftTo(1,bu)}else{if(!bs.isEven()){bs.subTo(bt,bs)}}bs.rShiftTo(1,bs)}while(bv.isEven()){bv.rShiftTo(1,bv);if(bx){if(!bz.isEven()||!by.isEven()){bz.addTo(this,bz);by.subTo(bt,by)}bz.rShiftTo(1,bz)}else{if(!by.isEven()){by.subTo(bt,by)}}by.rShiftTo(1,by)}if(bw.compareTo(bv)>=0){bw.subTo(bv,bw);if(bx){bu.subTo(bz,bu)}bs.subTo(by,bs)}else{bv.subTo(bw,bv);if(bx){bz.subTo(bu,bz)}by.subTo(bs,by)}}if(bv.compareTo(bc.ONE)!=0){return bc.ZERO}if(by.compareTo(bt)>=0){return by.subtract(bt)}if(by.signum()<0){by.addTo(bt,by)}else{return by}if(by.signum()<0){return by.add(bt)}else{return by}}var az=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997];var aA=(1<<26)/az[az.length-1];function ae(bw){var bv,bt=this.abs();if(bt.t==1&&bt[0]<=az[az.length-1]){for(bv=0;bv<az.length;++bv){if(bt[0]==az[bv]){return true}}return false}if(bt.isEven()){return false}bv=1;while(bv<az.length){var bs=az[bv],bu=bv+1;while(bu<az.length&&bs<aA){bs*=az[bu++]}bs=bt.modInt(bs);while(bv<bu){if(bs%az[bv++]==0){return false}}}return bt.millerRabin(bw)}function i(bw){var bx=this.subtract(bc.ONE);var bt=bx.getLowestSetBit();if(bt<=0){return false}var by=bx.shiftRight(bt);bw=(bw+1)>>1;if(bw>az.length){bw=az.length}var bs=m();for(var bv=0;bv<bw;++bv){bs.fromInt(az[Math.floor(Math.random()*az.length)]);var bz=bs.modPow(by,this);if(bz.compareTo(bc.ONE)!=0&&bz.compareTo(bx)!=0){var bu=1;while(bu++<bt&&bz.compareTo(bx)!=0){bz=bz.modPowInt(2,this);if(bz.compareTo(bc.ONE)==0){return false}}if(bz.compareTo(bx)!=0){return false}}}return true}bc.prototype.chunkSize=aK;bc.prototype.toRadix=K;bc.prototype.fromRadix=aB;bc.prototype.fromNumber=aX;bc.prototype.bitwiseTo=aW;bc.prototype.changeBit=W;bc.prototype.addTo=aC;bc.prototype.dMultiply=o;bc.prototype.dAddOffset=al;bc.prototype.multiplyLowerTo=l;bc.prototype.multiplyUpperTo=g;bc.prototype.modInt=z;bc.prototype.millerRabin=i;bc.prototype.clone=k;bc.prototype.intValue=X;bc.prototype.byteValue=aZ;bc.prototype.shortValue=aq;bc.prototype.signum=bd;bc.prototype.toByteArray=bl;bc.prototype.equals=ax;bc.prototype.min=Y;bc.prototype.max=aF;bc.prototype.and=bn;bc.prototype.or=aJ;bc.prototype.xor=f;bc.prototype.andNot=t;bc.prototype.not=T;bc.prototype.shiftLeft=E;bc.prototype.shiftRight=bm;bc.prototype.getLowestSetBit=w;bc.prototype.bitCount=aU;bc.prototype.testBit=aS;bc.prototype.setBit=Q;bc.prototype.clearBit=u;bc.prototype.flipBit=c;bc.prototype.add=aE;bc.prototype.subtract=be;bc.prototype.multiply=aw;bc.prototype.divide=e;bc.prototype.remainder=j;bc.prototype.divideAndRemainder=aT;bc.prototype.modPow=aG;bc.prototype.modInverse=b;bc.prototype.pow=H;bc.prototype.gcd=bg;bc.prototype.isProbablePrime=ae;bc.prototype.square=aR;var aO=bc;aO.prototype.IsNegative=function(){if(this.compareTo(aO.ZERO)==-1){return true}else{return false}};aO.op_Equality=function(bt,bs){if(bt.compareTo(bs)==0){return true}else{return false}};aO.op_Inequality=function(bt,bs){if(bt.compareTo(bs)!=0){return true}else{return false}};aO.op_GreaterThan=function(bt,bs){if(bt.compareTo(bs)>0){return true}else{return false}};aO.op_LessThan=function(bt,bs){if(bt.compareTo(bs)<0){return true}else{return false}};aO.op_Addition=function(bs,bt){return new aO(bs).add(new aO(bt))};aO.op_Subtraction=function(bs,bt){return new aO(bs).subtract(new aO(bt))};aO.Int128Mul=function(bs,bt){return new aO(bs).multiply(new aO(bt))};aO.op_Division=function(bs,bt){return bs.divide(bt)};aO.prototype.ToDouble=function(){return parseFloat(this.toString())};if(typeof(bj)=="undefined"){var bj=function(bw,bv){var bu;if(typeof(Object.getOwnPropertyNames)=="undefined"){for(bu in bv.prototype){if(typeof(bw.prototype[bu])=="undefined"||bw.prototype[bu]==Object.prototype[bu]){bw.prototype[bu]=bv.prototype[bu]}}for(bu in bv){if(typeof(bw[bu])=="undefined"){bw[bu]=bv[bu]}}bw.$baseCtor=bv}else{var bt=Object.getOwnPropertyNames(bv.prototype);for(var bs=0;bs<bt.length;bs++){if(typeof(Object.getOwnPropertyDescriptor(bw.prototype,bt[bs]))=="undefined"){Object.defineProperty(bw.prototype,bt[bs],Object.getOwnPropertyDescriptor(bv.prototype,bt[bs]))}}for(bu in bv){if(typeof(bw[bu])=="undefined"){bw[bu]=bv[bu]}}bw.$baseCtor=bv}}}ar.Path=function(){return[]};ar.Paths=function(){return[]};ar.DoublePoint=function(){var bs=arguments;this.X=0;this.Y=0;if(bs.length==1){this.X=bs[0].X;this.Y=bs[0].Y}else{if(bs.length==2){this.X=bs[0];this.Y=bs[1]}}};ar.DoublePoint0=function(){this.X=0;this.Y=0};ar.DoublePoint1=function(bs){this.X=bs.X;this.Y=bs.Y};ar.DoublePoint2=function(bs,bt){this.X=bs;this.Y=bt};ar.PolyNode=function(){this.m_Parent=null;this.m_polygon=new ar.Path();this.m_Index=0;this.m_jointype=0;this.m_endtype=0;this.m_Childs=[];this.IsOpen=false};ar.PolyNode.prototype.IsHoleNode=function(){var bs=true;var bt=this.m_Parent;while(bt!==null){bs=!bs;bt=bt.m_Parent}return bs};ar.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length};ar.PolyNode.prototype.Contour=function(){return this.m_polygon};ar.PolyNode.prototype.AddChild=function(bt){var bs=this.m_Childs.length;this.m_Childs.push(bt);bt.m_Parent=this;bt.m_Index=bs};ar.PolyNode.prototype.GetNext=function(){if(this.m_Childs.length>0){return this.m_Childs[0]}else{return this.GetNextSiblingUp()}};ar.PolyNode.prototype.GetNextSiblingUp=function(){if(this.m_Parent===null){return null}else{if(this.m_Index==this.m_Parent.m_Childs.length-1){return this.m_Parent.GetNextSiblingUp()}else{return this.m_Parent.m_Childs[this.m_Index+1]}}};ar.PolyNode.prototype.Childs=function(){return this.m_Childs};ar.PolyNode.prototype.Parent=function(){return this.m_Parent};ar.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()};ar.PolyTree=function(){this.m_AllPolys=[];ar.PolyNode.call(this)};ar.PolyTree.prototype.Clear=function(){for(var bt=0,bs=this.m_AllPolys.length;bt<bs;bt++){this.m_AllPolys[bt]=null}this.m_AllPolys.length=0;this.m_Childs.length=0};ar.PolyTree.prototype.GetFirst=function(){if(this.m_Childs.length>0){return this.m_Childs[0]}else{return null}};ar.PolyTree.prototype.Total=function(){return this.m_AllPolys.length};bj(ar.PolyTree,ar.PolyNode);ar.Math_Abs_Int64=ar.Math_Abs_Int32=ar.Math_Abs_Double=function(bs){return Math.abs(bs)};ar.Math_Max_Int32_Int32=function(bt,bs){return Math.max(bt,bs)};if(a2.msie||a2.opera||a2.safari){ar.Cast_Int32=function(bs){return bs|0}}else{ar.Cast_Int32=function(bs){return ~~bs}}if(a2.chrome){ar.Cast_Int64=function(bs){if(bs<-2147483648||bs>2147483647){return bs<0?Math.ceil(bs):Math.floor(bs)}else{return ~~bs}}}else{if(a2.firefox&&typeof(Number.toInteger)=="function"){ar.Cast_Int64=function(bs){return Number.toInteger(bs)}}else{if(a2.msie7||a2.msie8){ar.Cast_Int64=function(bs){return parseInt(bs,10)}}else{if(a2.msie){ar.Cast_Int64=function(bs){if(bs<-2147483648||bs>2147483647){return bs<0?Math.ceil(bs):Math.floor(bs)}return bs|0}}else{ar.Cast_Int64=function(bs){return bs<0?Math.ceil(bs):Math.floor(bs)}}}}}ar.Clear=function(bs){bs.length=0};ar.PI=3.141592653589793;ar.PI2=2*3.141592653589793;ar.IntPoint=function(){var bs=arguments,bt=bs.length;this.X=0;this.Y=0;if(av){this.Z=0;if(bt==3){this.X=bs[0];this.Y=bs[1];this.Z=bs[2]}else{if(bt==2){this.X=bs[0];this.Y=bs[1];this.Z=0}else{if(bt==1){if(bs[0] instanceof ar.DoublePoint){var bv=bs[0];this.X=ar.Clipper.Round(bv.X);this.Y=ar.Clipper.Round(bv.Y);this.Z=0}else{var bu=bs[0];if(typeof(bu.Z)=="undefined"){bu.Z=0}this.X=bu.X;this.Y=bu.Y;this.Z=bu.Z}}else{this.X=0;this.Y=0;this.Z=0}}}}else{if(bt==2){this.X=bs[0];this.Y=bs[1]}else{if(bt==1){if(bs[0] instanceof ar.DoublePoint){var bv=bs[0];this.X=ar.Clipper.Round(bv.X);this.Y=ar.Clipper.Round(bv.Y)}else{var bu=bs[0];this.X=bu.X;this.Y=bu.Y}}else{this.X=0;this.Y=0}}}};ar.IntPoint.op_Equality=function(bt,bs){return bt.X==bs.X&&bt.Y==bs.Y};ar.IntPoint.op_Inequality=function(bt,bs){return bt.X!=bs.X||bt.Y!=bs.Y};if(av){ar.IntPoint0=function(){this.X=0;this.Y=0;this.Z=0};ar.IntPoint1=function(bs){this.X=bs.X;this.Y=bs.Y;this.Z=bs.Z};ar.IntPoint1dp=function(bs){this.X=ar.Clipper.Round(bs.X);this.Y=ar.Clipper.Round(bs.Y);this.Z=0};ar.IntPoint2=function(bs,bt){this.X=bs;this.Y=bt;this.Z=0};ar.IntPoint3=function(bs,bu,bt){this.X=bs;this.Y=bu;this.Z=bt}}else{ar.IntPoint0=function(){this.X=0;this.Y=0};ar.IntPoint1=function(bs){this.X=bs.X;this.Y=bs.Y};ar.IntPoint1dp=function(bs){this.X=ar.Clipper.Round(bs.X);this.Y=ar.Clipper.Round(bs.Y)};ar.IntPoint2=function(bs,bt){this.X=bs;this.Y=bt}}ar.IntRect=function(){var bs=arguments,bt=bs.length;if(bt==4){this.left=bs[0];this.top=bs[1];this.right=bs[2];this.bottom=bs[3]}else{if(bt==1){this.left=ir.left;this.top=ir.top;this.right=ir.right;this.bottom=ir.bottom}else{this.left=0;this.top=0;this.right=0;this.bottom=0}}};ar.IntRect0=function(){this.left=0;this.top=0;this.right=0;this.bottom=0};ar.IntRect1=function(bs){this.left=bs.left;this.top=bs.top;this.right=bs.right;this.bottom=bs.bottom};ar.IntRect4=function(bt,bu,bv,bs){this.left=bt;this.top=bu;this.right=bv;this.bottom=bs};ar.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};ar.PolyType={ptSubject:0,ptClip:1};ar.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};ar.JoinType={jtSquare:0,jtRound:1,jtMiter:2};ar.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4};if(aV){ar.EndType_={etSquare:0,etRound:1,etButt:2,etClosed:3}}ar.EdgeSide={esLeft:0,esRight:1};ar.Direction={dRightToLeft:0,dLeftToRight:1};ar.TEdge=function(){this.Bot=new ar.IntPoint();this.Curr=new ar.IntPoint();this.Top=new ar.IntPoint();this.Delta=new ar.IntPoint();this.Dx=0;this.PolyTyp=ar.PolyType.ptSubject;this.Side=ar.EdgeSide.esLeft;this.WindDelta=0;this.WindCnt=0;this.WindCnt2=0;this.OutIdx=0;this.Next=null;this.Prev=null;this.NextInLML=null;this.NextInAEL=null;this.PrevInAEL=null;this.NextInSEL=null;this.PrevInSEL=null};ar.IntersectNode=function(){this.Edge1=null;this.Edge2=null;this.Pt=new ar.IntPoint()};ar.MyIntersectNodeSort=function(){};ar.MyIntersectNodeSort.Compare=function(bt,bs){return(bs.Pt.Y-bt.Pt.Y)};ar.LocalMinima=function(){this.Y=0;this.LeftBound=null;this.RightBound=null;this.Next=null};ar.Scanbeam=function(){this.Y=0;this.Next=null};ar.OutRec=function(){this.Idx=0;this.IsHole=false;this.IsOpen=false;this.FirstLeft=null;this.Pts=null;this.BottomPt=null;this.PolyNode=null};ar.OutPt=function(){this.Idx=0;this.Pt=new ar.IntPoint();this.Next=null;this.Prev=null};ar.Join=function(){this.OutPt1=null;this.OutPt2=null;this.OffPt=new ar.IntPoint()};ar.ClipperBase=function(){this.m_MinimaList=null;this.m_CurrentLM=null;this.m_edges=new Array();this.m_UseFullRange=false;this.m_HasOpenPaths=false;this.PreserveCollinear=false;this.m_MinimaList=null;this.m_CurrentLM=null;this.m_UseFullRange=false;this.m_HasOpenPaths=false};ar.ClipperBase.horizontal=-9007199254740992;ar.ClipperBase.Skip=-2;ar.ClipperBase.Unassigned=-1;ar.ClipperBase.tolerance=1e-20;if(J){ar.ClipperBase.loRange=46340;ar.ClipperBase.hiRange=46340}else{ar.ClipperBase.loRange=47453132;ar.ClipperBase.hiRange=4503599627370495}ar.ClipperBase.near_zero=function(bs){return(bs>-ar.ClipperBase.tolerance)&&(bs<ar.ClipperBase.tolerance)};ar.ClipperBase.IsHorizontal=function(bs){return bs.Delta.Y===0};ar.ClipperBase.prototype.PointIsVertex=function(bu,bt){var bs=bt;do{if(ar.IntPoint.op_Equality(bs.Pt,bu)){return true}bs=bs.Next}while(bs!=bt);return false};ar.ClipperBase.prototype.PointOnLineSegment=function(bv,bt,bs,bu){if(bu){return((bv.X==bt.X)&&(bv.Y==bt.Y))||((bv.X==bs.X)&&(bv.Y==bs.Y))||(((bv.X>bt.X)==(bv.X<bs.X))&&((bv.Y>bt.Y)==(bv.Y<bs.Y))&&(aO.op_Equality(aO.Int128Mul((bv.X-bt.X),(bs.Y-bt.Y)),aO.Int128Mul((bs.X-bt.X),(bv.Y-bt.Y)))))}else{return((bv.X==bt.X)&&(bv.Y==bt.Y))||((bv.X==bs.X)&&(bv.Y==bs.Y))||(((bv.X>bt.X)==(bv.X<bs.X))&&((bv.Y>bt.Y)==(bv.Y<bs.Y))&&((bv.X-bt.X)*(bs.Y-bt.Y)==(bs.X-bt.X)*(bv.Y-bt.Y)))}};ar.ClipperBase.prototype.PointOnPolygon=function(bv,bt,bu){var bs=bt;while(true){if(this.PointOnLineSegment(bv,bs.Pt,bs.Next.Pt,bu)){return true}bs=bs.Next;if(bs==bt){break}}return false};ar.ClipperBase.prototype.SlopesEqual=ar.ClipperBase.SlopesEqual=function(){var bx=arguments,bs=bx.length;var bu,bt,bA,bz,bw,bv,by;if(bs==3){bu=bx[0];bt=bx[1];by=bx[2];if(by){return aO.op_Equality(aO.Int128Mul(bu.Delta.Y,bt.Delta.X),aO.Int128Mul(bu.Delta.X,bt.Delta.Y))}else{return ar.Cast_Int64((bu.Delta.Y)*(bt.Delta.X))==ar.Cast_Int64((bu.Delta.X)*(bt.Delta.Y))}}else{if(bs==4){bA=bx[0];bz=bx[1];bw=bx[2];by=bx[3];if(by){return aO.op_Equality(aO.Int128Mul(bA.Y-bz.Y,bz.X-bw.X),aO.Int128Mul(bA.X-bz.X,bz.Y-bw.Y))}else{return ar.Cast_Int64((bA.Y-bz.Y)*(bz.X-bw.X))-ar.Cast_Int64((bA.X-bz.X)*(bz.Y-bw.Y))===0}}else{bA=bx[0];bz=bx[1];bw=bx[2];bv=bx[3];by=bx[4];if(by){return aO.op_Equality(aO.Int128Mul(bA.Y-bz.Y,bw.X-bv.X),aO.Int128Mul(bA.X-bz.X,bw.Y-bv.Y))}else{return ar.Cast_Int64((bA.Y-bz.Y)*(bw.X-bv.X))-ar.Cast_Int64((bA.X-bz.X)*(bw.Y-bv.Y))===0}}}};ar.ClipperBase.SlopesEqual3=function(bu,bt,bs){if(bs){return aO.op_Equality(aO.Int128Mul(bu.Delta.Y,bt.Delta.X),aO.Int128Mul(bu.Delta.X,bt.Delta.Y))}else{return ar.Cast_Int64((bu.Delta.Y)*(bt.Delta.X))==ar.Cast_Int64((bu.Delta.X)*(bt.Delta.Y))}};ar.ClipperBase.SlopesEqual4=function(bv,bu,bt,bs){if(bs){return aO.op_Equality(aO.Int128Mul(bv.Y-bu.Y,bu.X-bt.X),aO.Int128Mul(bv.X-bu.X,bu.Y-bt.Y))}else{return ar.Cast_Int64((bv.Y-bu.Y)*(bu.X-bt.X))-ar.Cast_Int64((bv.X-bu.X)*(bu.Y-bt.Y))===0}};ar.ClipperBase.SlopesEqual5=function(bw,bv,bu,bt,bs){if(bs){return aO.op_Equality(aO.Int128Mul(bw.Y-bv.Y,bu.X-bt.X),aO.Int128Mul(bw.X-bv.X,bu.Y-bt.Y))}else{return ar.Cast_Int64((bw.Y-bv.Y)*(bu.X-bt.X))-ar.Cast_Int64((bw.X-bv.X)*(bu.Y-bt.Y))===0}};ar.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var bv=0,bu=this.m_edges.length;bv<bu;++bv){for(var bt=0,bs=this.m_edges[bv].length;bt<bs;++bt){this.m_edges[bv][bt]=null}ar.Clear(this.m_edges[bv])}ar.Clear(this.m_edges);this.m_UseFullRange=false;this.m_HasOpenPaths=false};ar.ClipperBase.prototype.DisposeLocalMinimaList=function(){while(this.m_MinimaList!==null){var bs=this.m_MinimaList.Next;this.m_MinimaList=null;this.m_MinimaList=bs}this.m_CurrentLM=null};ar.ClipperBase.prototype.RangeTest=function(bt,bs){if(bs.Value){if(bt.X>ar.ClipperBase.hiRange||bt.Y>ar.ClipperBase.hiRange||-bt.X>ar.ClipperBase.hiRange||-bt.Y>ar.ClipperBase.hiRange){ar.Error("Coordinate outside allowed range in RangeTest().")}}else{if(bt.X>ar.ClipperBase.loRange||bt.Y>ar.ClipperBase.loRange||-bt.X>ar.ClipperBase.loRange||-bt.Y>ar.ClipperBase.loRange){bs.Value=true;this.RangeTest(bt,bs)}}};ar.ClipperBase.prototype.InitEdge=function(bv,bs,bt,bu){bv.Next=bs;bv.Prev=bt;bv.Curr.X=bu.X;bv.Curr.Y=bu.Y;bv.OutIdx=-1};ar.ClipperBase.prototype.InitEdge2=function(bt,bs){if(bt.Curr.Y>=bt.Next.Curr.Y){bt.Bot.X=bt.Curr.X;bt.Bot.Y=bt.Curr.Y;bt.Top.X=bt.Next.Curr.X;bt.Top.Y=bt.Next.Curr.Y}else{bt.Top.X=bt.Curr.X;bt.Top.Y=bt.Curr.Y;bt.Bot.X=bt.Next.Curr.X;bt.Bot.Y=bt.Next.Curr.Y}this.SetDx(bt);bt.PolyTyp=bs};ar.ClipperBase.prototype.FindNextLocMin=function(bs){var bt;for(;;){while(ar.IntPoint.op_Inequality(bs.Bot,bs.Prev.Bot)||ar.IntPoint.op_Equality(bs.Curr,bs.Top)){bs=bs.Next}if(bs.Dx!=ar.ClipperBase.horizontal&&bs.Prev.Dx!=ar.ClipperBase.horizontal){break}while(bs.Prev.Dx==ar.ClipperBase.horizontal){bs=bs.Prev}bt=bs;while(bs.Dx==ar.ClipperBase.horizontal){bs=bs.Next}if(bs.Top.Y==bs.Prev.Bot.Y){continue}if(bt.Prev.Bot.X<bs.Bot.X){bs=bt}break}return bs};ar.ClipperBase.prototype.ProcessBound=function(bv,bs){var bt,bx=bv;var bu;if(bx.OutIdx==ar.ClipperBase.Skip){bv=bx;if(bs){while(bv.Top.Y==bv.Next.Bot.Y){bv=bv.Next}while(bv!=bx&&bv.Dx==ar.ClipperBase.horizontal){bv=bv.Prev}}else{while(bv.Top.Y==bv.Prev.Bot.Y){bv=bv.Prev}while(bv!=bx&&bv.Dx==ar.ClipperBase.horizontal){bv=bv.Next}}if(bv==bx){if(bs){bx=bv.Next}else{bx=bv.Prev}}else{if(bs){bv=bx.Next}else{bv=bx.Prev}var bw=new ar.LocalMinima();bw.Next=null;bw.Y=bv.Bot.Y;bw.LeftBound=null;bw.RightBound=bv;bw.RightBound.WindDelta=0;bx=this.ProcessBound(bw.RightBound,bs);this.InsertLocalMinima(bw)}return bx}if(bv.Dx==ar.ClipperBase.horizontal){if(bs){bt=bv.Prev}else{bt=bv.Next}if(bt.OutIdx!=ar.ClipperBase.Skip){if(bt.Dx==ar.ClipperBase.horizontal){if(bt.Bot.X!=bv.Bot.X&&bt.Top.X!=bv.Bot.X){this.ReverseHorizontal(bv)}}else{if(bt.Bot.X!=bv.Bot.X){this.ReverseHorizontal(bv)}}}}bt=bv;if(bs){while(bx.Top.Y==bx.Next.Bot.Y&&bx.Next.OutIdx!=ar.ClipperBase.Skip){bx=bx.Next}if(bx.Dx==ar.ClipperBase.horizontal&&bx.Next.OutIdx!=ar.ClipperBase.Skip){bu=bx;while(bu.Prev.Dx==ar.ClipperBase.horizontal){bu=bu.Prev}if(bu.Prev.Top.X==bx.Next.Top.X){if(!bs){bx=bu.Prev}}else{if(bu.Prev.Top.X>bx.Next.Top.X){bx=bu.Prev}}}while(bv!=bx){bv.NextInLML=bv.Next;if(bv.Dx==ar.ClipperBase.horizontal&&bv!=bt&&bv.Bot.X!=bv.Prev.Top.X){this.ReverseHorizontal(bv)}bv=bv.Next}if(bv.Dx==ar.ClipperBase.horizontal&&bv!=bt&&bv.Bot.X!=bv.Prev.Top.X){this.ReverseHorizontal(bv)}bx=bx.Next}else{while(bx.Top.Y==bx.Prev.Bot.Y&&bx.Prev.OutIdx!=ar.ClipperBase.Skip){bx=bx.Prev}if(bx.Dx==ar.ClipperBase.horizontal&&bx.Prev.OutIdx!=ar.ClipperBase.Skip){bu=bx;while(bu.Next.Dx==ar.ClipperBase.horizontal){bu=bu.Next}if(bu.Next.Top.X==bx.Prev.Top.X){if(!bs){bx=bu.Next}}else{if(bu.Next.Top.X>bx.Prev.Top.X){bx=bu.Next}}}while(bv!=bx){bv.NextInLML=bv.Prev;if(bv.Dx==ar.ClipperBase.horizontal&&bv!=bt&&bv.Bot.X!=bv.Next.Top.X){this.ReverseHorizontal(bv)}bv=bv.Prev}if(bv.Dx==ar.ClipperBase.horizontal&&bv!=bt&&bv.Bot.X!=bv.Next.Top.X){this.ReverseHorizontal(bv)}bx=bx.Prev}return bx};ar.ClipperBase.prototype.AddPath=function(bz,bE,bA){if(P){if(!bA&&bE==ar.PolyType.ptClip){ar.Error("AddPath: Open paths must be subject.")}}else{if(!bA){ar.Error("AddPath: Open paths have been disabled.")}}var bB=bz.length-1;if(bA){while(bB>0&&(ar.IntPoint.op_Equality(bz[bB],bz[0]))){--bB}}while(bB>0&&(ar.IntPoint.op_Equality(bz[bB],bz[bB-1]))){--bB}if((bA&&bB<2)||(!bA&&bB<1)){return false}var bw=new Array();for(var by=0;by<=bB;by++){bw.push(new ar.TEdge())}var bG=true;bw[1].Curr.X=bz[1].X;bw[1].Curr.Y=bz[1].Y;var bv={Value:this.m_UseFullRange};this.RangeTest(bz[0],bv);this.m_UseFullRange=bv.Value;bv.Value=this.m_UseFullRange;this.RangeTest(bz[bB],bv);this.m_UseFullRange=bv.Value;this.InitEdge(bw[0],bw[1],bw[bB],bz[0]);this.InitEdge(bw[bB],bw[0],bw[bB-1],bz[bB]);for(var by=bB-1;by>=1;--by){bv.Value=this.m_UseFullRange;this.RangeTest(bz[by],bv);this.m_UseFullRange=bv.Value;this.InitEdge(bw[by],bw[by+1],bw[by-1],bz[by])}var bF=bw[0];var bH=bF,bC=bF;for(;;){if((ar.IntPoint.op_Equality(bH.Curr,bH.Next.Curr)&&(bA||bH.Next!=bF))){if(bH==bH.Next){break}if(bH==bF){bF=bH.Next}bH=this.RemoveEdge(bH);bC=bH;continue}if(bH.Prev==bH.Next){break}else{if(bA&&ar.ClipperBase.SlopesEqual(bH.Prev.Curr,bH.Curr,bH.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(bH.Prev.Curr,bH.Curr,bH.Next.Curr))){if(bH==bF){bF=bH.Next}bH=this.RemoveEdge(bH);bH=bH.Prev;bC=bH;continue}}bH=bH.Next;if((bH==bC)||(!bA&&bH.Next==bF)){break}}if((!bA&&(bH==bH.Next))||(bA&&(bH.Prev==bH.Next))){return false}if(!bA){this.m_HasOpenPaths=true;bF.Prev.OutIdx=ar.ClipperBase.Skip}var bs=bF;bH=bF;do{this.InitEdge2(bH,bE);bH=bH.Next;if(bG&&bH.Curr.Y!=bF.Curr.Y){bG=false}}while(bH!=bF);if(bG){if(bA){return false}bH.Prev.OutIdx=ar.ClipperBase.Skip;if(bH.Prev.Bot.X<bH.Prev.Top.X){this.ReverseHorizontal(bH.Prev)}var bt=new ar.LocalMinima();bt.Next=null;bt.Y=bH.Bot.Y;bt.LeftBound=null;bt.RightBound=bH;bt.RightBound.Side=ar.EdgeSide.esRight;bt.RightBound.WindDelta=0;while(bH.Next.OutIdx!=ar.ClipperBase.Skip){bH.NextInLML=bH.Next;if(bH.Bot.X!=bH.Prev.Top.X){this.ReverseHorizontal(bH)}bH=bH.Next}this.InsertLocalMinima(bt);this.m_edges.push(bw);return true}this.m_edges.push(bw);var bu;var bx=null;if(bH.Prev.Bot==bH.Prev.Top){bH=bH.Next}for(;;){bH=this.FindNextLocMin(bH);if(bH==bx){break}else{if(bx==null){bx=bH}}var bt=new ar.LocalMinima();bt.Next=null;bt.Y=bH.Bot.Y;if(bH.Dx<bH.Prev.Dx){bt.LeftBound=bH.Prev;bt.RightBound=bH;bu=false}else{bt.LeftBound=bH;bt.RightBound=bH.Prev;bu=true}bt.LeftBound.Side=ar.EdgeSide.esLeft;bt.RightBound.Side=ar.EdgeSide.esRight;if(!bA){bt.LeftBound.WindDelta=0}else{if(bt.LeftBound.Next==bt.RightBound){bt.LeftBound.WindDelta=-1}else{bt.LeftBound.WindDelta=1}}bt.RightBound.WindDelta=-bt.LeftBound.WindDelta;bH=this.ProcessBound(bt.LeftBound,bu);if(bH.OutIdx==ar.ClipperBase.Skip){bH=this.ProcessBound(bH,bu)}var bD=this.ProcessBound(bt.RightBound,!bu);if(bD.OutIdx==ar.ClipperBase.Skip){bD=this.ProcessBound(bD,!bu)}if(bt.LeftBound.OutIdx==ar.ClipperBase.Skip){bt.LeftBound=null}else{if(bt.RightBound.OutIdx==ar.ClipperBase.Skip){bt.RightBound=null}}this.InsertLocalMinima(bt);if(!bu){bH=bD}}return true};ar.ClipperBase.prototype.AddPaths=function(bu,bv,bt){var bs=false;for(var bx=0,bw=bu.length;bx<bw;++bx){if(this.AddPath(bu[bx],bv,bt)){bs=true}}return bs};ar.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(bu,bt,bs){if((ar.IntPoint.op_Equality(bu,bs))||(ar.IntPoint.op_Equality(bu,bt))||(ar.IntPoint.op_Equality(bs,bt))){return false}else{if(bu.X!=bs.X){return(bt.X>bu.X)==(bt.X<bs.X)}else{return(bt.Y>bu.Y)==(bt.Y<bs.Y)}}};ar.ClipperBase.prototype.RemoveEdge=function(bt){bt.Prev.Next=bt.Next;bt.Next.Prev=bt.Prev;var bs=bt.Next;bt.Prev=null;return bs};ar.ClipperBase.prototype.SetDx=function(bs){bs.Delta.X=(bs.Top.X-bs.Bot.X);bs.Delta.Y=(bs.Top.Y-bs.Bot.Y);if(bs.Delta.Y===0){bs.Dx=ar.ClipperBase.horizontal}else{bs.Dx=(bs.Delta.X)/(bs.Delta.Y)}};ar.ClipperBase.prototype.InsertLocalMinima=function(bs){if(this.m_MinimaList===null){this.m_MinimaList=bs}else{if(bs.Y>=this.m_MinimaList.Y){bs.Next=this.m_MinimaList;this.m_MinimaList=bs}else{var bt=this.m_MinimaList;while(bt.Next!==null&&(bs.Y<bt.Next.Y)){bt=bt.Next}bs.Next=bt.Next;bt.Next=bs}}};ar.ClipperBase.prototype.PopLocalMinima=function(){if(this.m_CurrentLM===null){return}this.m_CurrentLM=this.m_CurrentLM.Next};ar.ClipperBase.prototype.ReverseHorizontal=function(bt){var bs=bt.Top.X;bt.Top.X=bt.Bot.X;bt.Bot.X=bs;if(av){bs=bt.Top.Z;bt.Top.Z=bt.Bot.Z;bt.Bot.Z=bs}};ar.ClipperBase.prototype.Reset=function(){this.m_CurrentLM=this.m_MinimaList;if(this.m_CurrentLM==null){return}var bs=this.m_MinimaList;while(bs!=null){var bt=bs.LeftBound;if(bt!=null){bt.Curr.X=bt.Bot.X;bt.Curr.Y=bt.Bot.Y;bt.Side=ar.EdgeSide.esLeft;bt.OutIdx=ar.ClipperBase.Unassigned}bt=bs.RightBound;if(bt!=null){bt.Curr.X=bt.Bot.X;bt.Curr.Y=bt.Bot.Y;bt.Side=ar.EdgeSide.esRight;bt.OutIdx=ar.ClipperBase.Unassigned}bs=bs.Next}};ar.Clipper=function(bs){if(typeof(bs)=="undefined"){bs=0}this.m_PolyOuts=null;this.m_ClipType=ar.ClipType.ctIntersection;this.m_Scanbeam=null;this.m_ActiveEdges=null;this.m_SortedEdges=null;this.m_IntersectList=null;this.m_IntersectNodeComparer=null;this.m_ExecuteLocked=false;this.m_ClipFillType=ar.PolyFillType.pftEvenOdd;this.m_SubjFillType=ar.PolyFillType.pftEvenOdd;this.m_Joins=null;this.m_GhostJoins=null;this.m_UsingPolyTree=false;this.ReverseSolution=false;this.StrictlySimple=false;ar.ClipperBase.call(this);this.m_Scanbeam=null;this.m_ActiveEdges=null;this.m_SortedEdges=null;this.m_IntersectList=new Array();this.m_IntersectNodeComparer=ar.MyIntersectNodeSort.Compare;this.m_ExecuteLocked=false;this.m_UsingPolyTree=false;this.m_PolyOuts=new Array();this.m_Joins=new Array();this.m_GhostJoins=new Array();this.ReverseSolution=(1&bs)!==0;this.StrictlySimple=(2&bs)!==0;this.PreserveCollinear=(4&bs)!==0;if(av){this.ZFillFunction=null}};ar.Clipper.ioReverseSolution=1;ar.Clipper.ioStrictlySimple=2;ar.Clipper.ioPreserveCollinear=4;ar.Clipper.prototype.Clear=function(){if(this.m_edges.length===0){return}this.DisposeAllPolyPts();ar.ClipperBase.prototype.Clear.call(this)};ar.Clipper.prototype.DisposeScanbeamList=function(){while(this.m_Scanbeam!==null){var bs=this.m_Scanbeam.Next;this.m_Scanbeam=null;this.m_Scanbeam=bs}};ar.Clipper.prototype.Reset=function(){ar.ClipperBase.prototype.Reset.call(this);this.m_Scanbeam=null;this.m_ActiveEdges=null;this.m_SortedEdges=null;var bs=this.m_MinimaList;while(bs!==null){this.InsertScanbeam(bs.Y);bs=bs.Next}};ar.Clipper.prototype.InsertScanbeam=function(bu){if(this.m_Scanbeam===null){this.m_Scanbeam=new ar.Scanbeam();this.m_Scanbeam.Next=null;this.m_Scanbeam.Y=bu}else{if(bu>this.m_Scanbeam.Y){var bs=new ar.Scanbeam();bs.Y=bu;bs.Next=this.m_Scanbeam;this.m_Scanbeam=bs}else{var bt=this.m_Scanbeam;while(bt.Next!==null&&(bu<=bt.Next.Y)){bt=bt.Next}if(bu==bt.Y){return}var bs=new ar.Scanbeam();bs.Y=bu;bs.Next=bt.Next;bt.Next=bs}}};ar.Clipper.prototype.Execute=function(){var bz=arguments,bt=bz.length,bw=bz[1] instanceof ar.PolyTree;if(bt==4&&!bw){var bu=bz[0],bx=bz[1],bv=bz[2],bs=bz[3];if(this.m_ExecuteLocked){return false}if(this.m_HasOpenPaths){ar.Error("Error: PolyTree struct is need for open path clipping.")}this.m_ExecuteLocked=true;ar.Clear(bx);this.m_SubjFillType=bv;this.m_ClipFillType=bs;this.m_ClipType=bu;this.m_UsingPolyTree=false;try{var bA=this.ExecuteInternal();if(bA){this.BuildResult(bx)}}finally{this.DisposeAllPolyPts();this.m_ExecuteLocked=false}return bA}else{if(bt==4&&bw){var bu=bz[0],by=bz[1],bv=bz[2],bs=bz[3];if(this.m_ExecuteLocked){return false}this.m_ExecuteLocked=true;this.m_SubjFillType=bv;this.m_ClipFillType=bs;this.m_ClipType=bu;this.m_UsingPolyTree=true;try{var bA=this.ExecuteInternal();if(bA){this.BuildResult2(by)}}finally{this.DisposeAllPolyPts();this.m_ExecuteLocked=false}return bA}else{if(bt==2&&!bw){var bu=bz[0],bx=bz[1];return this.Execute(bu,bx,ar.PolyFillType.pftEvenOdd,ar.PolyFillType.pftEvenOdd)}else{if(bt==2&&bw){var bu=bz[0],by=bz[1];return this.Execute(bu,by,ar.PolyFillType.pftEvenOdd,ar.PolyFillType.pftEvenOdd)}}}}};ar.Clipper.prototype.FixHoleLinkage=function(bs){if(bs.FirstLeft===null||(bs.IsHole!=bs.FirstLeft.IsHole&&bs.FirstLeft.Pts!==null)){return}var bt=bs.FirstLeft;while(bt!==null&&((bt.IsHole==bs.IsHole)||bt.Pts===null)){bt=bt.FirstLeft}bs.FirstLeft=bt};ar.Clipper.prototype.ExecuteInternal=function(){try{this.Reset();if(this.m_CurrentLM===null){return false}var bw=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(bw);ar.Clear(this.m_GhostJoins);this.ProcessHorizontals(false);if(this.m_Scanbeam===null){break}var bs=this.PopScanbeam();if(!this.ProcessIntersections(bw,bs)){return false}this.ProcessEdgesAtTopOfScanbeam(bs);bw=bs}while(this.m_Scanbeam!==null||this.m_CurrentLM!==null);for(var bu=0,bt=this.m_PolyOuts.length;bu<bt;bu++){var bv=this.m_PolyOuts[bu];if(bv.Pts===null||bv.IsOpen){continue}if((bv.IsHole^this.ReverseSolution)==(this.Area(bv)>0)){this.ReversePolyPtLinks(bv.Pts)}}this.JoinCommonEdges();for(var bu=0,bt=this.m_PolyOuts.length;bu<bt;bu++){var bv=this.m_PolyOuts[bu];if(bv.Pts!==null&&!bv.IsOpen){this.FixupOutPolygon(bv)}}if(this.StrictlySimple){this.DoSimplePolygons()}return true}finally{ar.Clear(this.m_Joins);ar.Clear(this.m_GhostJoins)}};ar.Clipper.prototype.PopScanbeam=function(){var bt=this.m_Scanbeam.Y;var bs=this.m_Scanbeam;this.m_Scanbeam=this.m_Scanbeam.Next;bs=null;return bt};ar.Clipper.prototype.DisposeAllPolyPts=function(){for(var bt=0,bs=this.m_PolyOuts.length;bt<bs;++bt){this.DisposeOutRec(bt)}ar.Clear(this.m_PolyOuts)};ar.Clipper.prototype.DisposeOutRec=function(bs){var bt=this.m_PolyOuts[bs];if(bt.Pts!==null){this.DisposeOutPts(bt.Pts)}bt=null;this.m_PolyOuts[bs]=null};ar.Clipper.prototype.DisposeOutPts=function(bt){if(bt===null){return}var bs=null;bt.Prev.Next=null;while(bt!==null){bs=bt;bt=bt.Next;bs=null}};ar.Clipper.prototype.AddJoin=function(bu,bs,bt){var bv=new ar.Join();bv.OutPt1=bu;bv.OutPt2=bs;bv.OffPt.X=bt.X;bv.OffPt.Y=bt.Y;this.m_Joins.push(bv)};ar.Clipper.prototype.AddGhostJoin=function(bt,bs){var bu=new ar.Join();bu.OutPt1=bt;bu.OffPt.X=bs.X;bu.OffPt.Y=bs.Y;this.m_GhostJoins.push(bu)};if(av){ar.Clipper.prototype.SetZ=function(bt,bu,bs){bt.Z=0;if(this.ZFillFunction!==null){this.ZFillFunction(bu.Bot,bu.Top,bs.Bot,bs.Top,bt)}}}ar.Clipper.prototype.InsertLocalMinimaIntoAEL=function(bx){while(this.m_CurrentLM!==null&&(this.m_CurrentLM.Y==bx)){var bv=this.m_CurrentLM.LeftBound;var bt=this.m_CurrentLM.RightBound;this.PopLocalMinima();var bu=null;if(bv===null){this.InsertEdgeIntoAEL(bt,null);this.SetWindingCount(bt);if(this.IsContributing(bt)){bu=this.AddOutPt(bt,bt.Bot)}}else{if(bt==null){this.InsertEdgeIntoAEL(bv,null);this.SetWindingCount(bv);if(this.IsContributing(bv)){bu=this.AddOutPt(bv,bv.Bot)}this.InsertScanbeam(bv.Top.Y)}else{this.InsertEdgeIntoAEL(bv,null);this.InsertEdgeIntoAEL(bt,bv);this.SetWindingCount(bv);bt.WindCnt=bv.WindCnt;bt.WindCnt2=bv.WindCnt2;if(this.IsContributing(bv)){bu=this.AddLocalMinPoly(bv,bt,bv.Bot)}this.InsertScanbeam(bv.Top.Y)}}if(bt!=null){if(ar.ClipperBase.IsHorizontal(bt)){this.AddEdgeToSEL(bt)}else{this.InsertScanbeam(bt.Top.Y)}}if(bv==null||bt==null){continue}if(bu!==null&&ar.ClipperBase.IsHorizontal(bt)&&this.m_GhostJoins.length>0&&bt.WindDelta!==0){for(var bz=0,bw=this.m_GhostJoins.length;bz<bw;bz++){var by=this.m_GhostJoins[bz];if(this.HorzSegmentsOverlap(by.OutPt1.Pt,by.OffPt,bt.Bot,bt.Top)){this.AddJoin(by.OutPt1,bu,by.OffPt)}}}if(bv.OutIdx>=0&&bv.PrevInAEL!==null&&bv.PrevInAEL.Curr.X==bv.Bot.X&&bv.PrevInAEL.OutIdx>=0&&ar.ClipperBase.SlopesEqual(bv.PrevInAEL,bv,this.m_UseFullRange)&&bv.WindDelta!==0&&bv.PrevInAEL.WindDelta!==0){var bs=this.AddOutPt(bv.PrevInAEL,bv.Bot);this.AddJoin(bu,bs,bv.Top)}if(bv.NextInAEL!=bt){if(bt.OutIdx>=0&&bt.PrevInAEL.OutIdx>=0&&ar.ClipperBase.SlopesEqual(bt.PrevInAEL,bt,this.m_UseFullRange)&&bt.WindDelta!==0&&bt.PrevInAEL.WindDelta!==0){var bs=this.AddOutPt(bt.PrevInAEL,bt.Bot);this.AddJoin(bu,bs,bt.Top)}var bA=bv.NextInAEL;if(bA!==null){while(bA!=bt){this.IntersectEdges(bt,bA,bv.Curr,true);bA=bA.NextInAEL}}}}};ar.Clipper.prototype.InsertEdgeIntoAEL=function(bt,bs){if(this.m_ActiveEdges===null){bt.PrevInAEL=null;bt.NextInAEL=null;this.m_ActiveEdges=bt}else{if(bs===null&&this.E2InsertsBeforeE1(this.m_ActiveEdges,bt)){bt.PrevInAEL=null;bt.NextInAEL=this.m_ActiveEdges;this.m_ActiveEdges.PrevInAEL=bt;this.m_ActiveEdges=bt}else{if(bs===null){bs=this.m_ActiveEdges}while(bs.NextInAEL!==null&&!this.E2InsertsBeforeE1(bs.NextInAEL,bt)){bs=bs.NextInAEL}bt.NextInAEL=bs.NextInAEL;if(bs.NextInAEL!==null){bs.NextInAEL.PrevInAEL=bt}bt.PrevInAEL=bs;bs.NextInAEL=bt}}};ar.Clipper.prototype.E2InsertsBeforeE1=function(bt,bs){if(bs.Curr.X==bt.Curr.X){if(bs.Top.Y>bt.Top.Y){return bs.Top.X<ar.Clipper.TopX(bt,bs.Top.Y)}else{return bt.Top.X>ar.Clipper.TopX(bs,bt.Top.Y)}}else{return bs.Curr.X<bt.Curr.X}};ar.Clipper.prototype.IsEvenOddFillType=function(bs){if(bs.PolyTyp==ar.PolyType.ptSubject){return this.m_SubjFillType==ar.PolyFillType.pftEvenOdd}else{return this.m_ClipFillType==ar.PolyFillType.pftEvenOdd}};ar.Clipper.prototype.IsEvenOddAltFillType=function(bs){if(bs.PolyTyp==ar.PolyType.ptSubject){return this.m_ClipFillType==ar.PolyFillType.pftEvenOdd}else{return this.m_SubjFillType==ar.PolyFillType.pftEvenOdd}};ar.Clipper.prototype.IsContributing=function(bt){var bs,bu;if(bt.PolyTyp==ar.PolyType.ptSubject){bs=this.m_SubjFillType;bu=this.m_ClipFillType}else{bs=this.m_ClipFillType;bu=this.m_SubjFillType}switch(bs){case ar.PolyFillType.pftEvenOdd:if(bt.WindDelta===0&&bt.WindCnt!=1){return false}break;case ar.PolyFillType.pftNonZero:if(Math.abs(bt.WindCnt)!=1){return false}break;case ar.PolyFillType.pftPositive:if(bt.WindCnt!=1){return false}break;default:if(bt.WindCnt!=-1){return false}break}switch(this.m_ClipType){case ar.ClipType.ctIntersection:switch(bu){case ar.PolyFillType.pftEvenOdd:case ar.PolyFillType.pftNonZero:return(bt.WindCnt2!==0);case ar.PolyFillType.pftPositive:return(bt.WindCnt2>0);default:return(bt.WindCnt2<0)}case ar.ClipType.ctUnion:switch(bu){case ar.PolyFillType.pftEvenOdd:case ar.PolyFillType.pftNonZero:return(bt.WindCnt2===0);case ar.PolyFillType.pftPositive:return(bt.WindCnt2<=0);default:return(bt.WindCnt2>=0)}case ar.ClipType.ctDifference:if(bt.PolyTyp==ar.PolyType.ptSubject){switch(bu){case ar.PolyFillType.pftEvenOdd:case ar.PolyFillType.pftNonZero:return(bt.WindCnt2===0);case ar.PolyFillType.pftPositive:return(bt.WindCnt2<=0);default:return(bt.WindCnt2>=0)}}else{switch(bu){case ar.PolyFillType.pftEvenOdd:case ar.PolyFillType.pftNonZero:return(bt.WindCnt2!==0);case ar.PolyFillType.pftPositive:return(bt.WindCnt2>0);default:return(bt.WindCnt2<0)}}case ar.ClipType.ctXor:if(bt.WindDelta===0){switch(bu){case ar.PolyFillType.pftEvenOdd:case ar.PolyFillType.pftNonZero:return(bt.WindCnt2===0);case ar.PolyFillType.pftPositive:return(bt.WindCnt2<=0);default:return(bt.WindCnt2>=0)}}else{return true}}return true};ar.Clipper.prototype.SetWindingCount=function(bs){var bu=bs.PrevInAEL;while(bu!==null&&((bu.PolyTyp!=bs.PolyTyp)||(bu.WindDelta===0))){bu=bu.PrevInAEL}if(bu===null){bs.WindCnt=(bs.WindDelta===0?1:bs.WindDelta);bs.WindCnt2=0;bu=this.m_ActiveEdges}else{if(bs.WindDelta===0&&this.m_ClipType!=ar.ClipType.ctUnion){bs.WindCnt=1;bs.WindCnt2=bu.WindCnt2;bu=bu.NextInAEL}else{if(this.IsEvenOddFillType(bs)){if(bs.WindDelta===0){var bv=true;var bt=bu.PrevInAEL;while(bt!==null){if(bt.PolyTyp==bu.PolyTyp&&bt.WindDelta!==0){bv=!bv}bt=bt.PrevInAEL}bs.WindCnt=(bv?0:1)}else{bs.WindCnt=bs.WindDelta}bs.WindCnt2=bu.WindCnt2;bu=bu.NextInAEL}else{if(bu.WindCnt*bu.WindDelta<0){if(Math.abs(bu.WindCnt)>1){if(bu.WindDelta*bs.WindDelta<0){bs.WindCnt=bu.WindCnt}else{bs.WindCnt=bu.WindCnt+bs.WindDelta}}else{bs.WindCnt=(bs.WindDelta===0?1:bs.WindDelta)}}else{if(bs.WindDelta===0){bs.WindCnt=(bu.WindCnt<0?bu.WindCnt-1:bu.WindCnt+1)}else{if(bu.WindDelta*bs.WindDelta<0){bs.WindCnt=bu.WindCnt}else{bs.WindCnt=bu.WindCnt+bs.WindDelta}}}bs.WindCnt2=bu.WindCnt2;bu=bu.NextInAEL}}}if(this.IsEvenOddAltFillType(bs)){while(bu!=bs){if(bu.WindDelta!==0){bs.WindCnt2=(bs.WindCnt2===0?1:0)}bu=bu.NextInAEL}}else{while(bu!=bs){bs.WindCnt2+=bu.WindDelta;bu=bu.NextInAEL}}};ar.Clipper.prototype.AddEdgeToSEL=function(bs){if(this.m_SortedEdges===null){this.m_SortedEdges=bs;bs.PrevInSEL=null;bs.NextInSEL=null}else{bs.NextInSEL=this.m_SortedEdges;bs.PrevInSEL=null;this.m_SortedEdges.PrevInSEL=bs;this.m_SortedEdges=bs}};ar.Clipper.prototype.CopyAELToSEL=function(){var bs=this.m_ActiveEdges;this.m_SortedEdges=bs;while(bs!==null){bs.PrevInSEL=bs.PrevInAEL;bs.NextInSEL=bs.NextInAEL;bs=bs.NextInAEL}};ar.Clipper.prototype.SwapPositionsInAEL=function(bt,bs){if(bt.NextInAEL==bt.PrevInAEL||bs.NextInAEL==bs.PrevInAEL){return}if(bt.NextInAEL==bs){var bu=bs.NextInAEL;if(bu!==null){bu.PrevInAEL=bt}var bv=bt.PrevInAEL;if(bv!==null){bv.NextInAEL=bs}bs.PrevInAEL=bv;bs.NextInAEL=bt;bt.PrevInAEL=bs;bt.NextInAEL=bu}else{if(bs.NextInAEL==bt){var bu=bt.NextInAEL;if(bu!==null){bu.PrevInAEL=bs}var bv=bs.PrevInAEL;if(bv!==null){bv.NextInAEL=bt}bt.PrevInAEL=bv;bt.NextInAEL=bs;bs.PrevInAEL=bt;bs.NextInAEL=bu}else{var bu=bt.NextInAEL;var bv=bt.PrevInAEL;bt.NextInAEL=bs.NextInAEL;if(bt.NextInAEL!==null){bt.NextInAEL.PrevInAEL=bt}bt.PrevInAEL=bs.PrevInAEL;if(bt.PrevInAEL!==null){bt.PrevInAEL.NextInAEL=bt}bs.NextInAEL=bu;if(bs.NextInAEL!==null){bs.NextInAEL.PrevInAEL=bs}bs.PrevInAEL=bv;if(bs.PrevInAEL!==null){bs.PrevInAEL.NextInAEL=bs}}}if(bt.PrevInAEL===null){this.m_ActiveEdges=bt}else{if(bs.PrevInAEL===null){this.m_ActiveEdges=bs}}};ar.Clipper.prototype.SwapPositionsInSEL=function(bt,bs){if(bt.NextInSEL===null&&bt.PrevInSEL===null){return}if(bs.NextInSEL===null&&bs.PrevInSEL===null){return}if(bt.NextInSEL==bs){var bu=bs.NextInSEL;if(bu!==null){bu.PrevInSEL=bt}var bv=bt.PrevInSEL;if(bv!==null){bv.NextInSEL=bs}bs.PrevInSEL=bv;bs.NextInSEL=bt;bt.PrevInSEL=bs;bt.NextInSEL=bu}else{if(bs.NextInSEL==bt){var bu=bt.NextInSEL;if(bu!==null){bu.PrevInSEL=bs}var bv=bs.PrevInSEL;if(bv!==null){bv.NextInSEL=bt}bt.PrevInSEL=bv;bt.NextInSEL=bs;bs.PrevInSEL=bt;bs.NextInSEL=bu}else{var bu=bt.NextInSEL;var bv=bt.PrevInSEL;bt.NextInSEL=bs.NextInSEL;if(bt.NextInSEL!==null){bt.NextInSEL.PrevInSEL=bt}bt.PrevInSEL=bs.PrevInSEL;if(bt.PrevInSEL!==null){bt.PrevInSEL.NextInSEL=bt}bs.NextInSEL=bu;if(bs.NextInSEL!==null){bs.NextInSEL.PrevInSEL=bs}bs.PrevInSEL=bv;if(bs.PrevInSEL!==null){bs.PrevInSEL.NextInSEL=bs}}}if(bt.PrevInSEL===null){this.m_SortedEdges=bt}else{if(bs.PrevInSEL===null){this.m_SortedEdges=bs}}};ar.Clipper.prototype.AddLocalMaxPoly=function(bu,bt,bs){this.AddOutPt(bu,bs);if(bt.WindDelta==0){this.AddOutPt(bt,bs)}if(bu.OutIdx==bt.OutIdx){bu.OutIdx=-1;bt.OutIdx=-1}else{if(bu.OutIdx<bt.OutIdx){this.AppendPolygon(bu,bt)}else{this.AppendPolygon(bt,bu)}}};ar.Clipper.prototype.AddLocalMinPoly=function(by,bx,bw){var bs;var bv,bu;if(ar.ClipperBase.IsHorizontal(bx)||(by.Dx>bx.Dx)){bs=this.AddOutPt(by,bw);bx.OutIdx=by.OutIdx;by.Side=ar.EdgeSide.esLeft;bx.Side=ar.EdgeSide.esRight;bv=by;if(bv.PrevInAEL==bx){bu=bx.PrevInAEL}else{bu=bv.PrevInAEL}}else{bs=this.AddOutPt(bx,bw);by.OutIdx=bx.OutIdx;by.Side=ar.EdgeSide.esRight;bx.Side=ar.EdgeSide.esLeft;bv=bx;if(bv.PrevInAEL==by){bu=by.PrevInAEL}else{bu=bv.PrevInAEL}}if(bu!==null&&bu.OutIdx>=0&&(ar.Clipper.TopX(bu,bw.Y)==ar.Clipper.TopX(bv,bw.Y))&&ar.ClipperBase.SlopesEqual(bv,bu,this.m_UseFullRange)&&(bv.WindDelta!==0)&&(bu.WindDelta!==0)){var bt=this.AddOutPt(bu,bw);this.AddJoin(bs,bt,bv.Top)}return bs};ar.Clipper.prototype.CreateOutRec=function(){var bs=new ar.OutRec();bs.Idx=-1;bs.IsHole=false;bs.IsOpen=false;bs.FirstLeft=null;bs.Pts=null;bs.BottomPt=null;bs.PolyNode=null;this.m_PolyOuts.push(bs);bs.Idx=this.m_PolyOuts.length-1;return bs};ar.Clipper.prototype.AddOutPt=function(bv,bu){var bw=(bv.Side==ar.EdgeSide.esLeft);if(bv.OutIdx<0){var bt=this.CreateOutRec();bt.IsOpen=(bv.WindDelta===0);var bs=new ar.OutPt();bt.Pts=bs;bs.Idx=bt.Idx;bs.Pt.X=bu.X;bs.Pt.Y=bu.Y;bs.Next=bs;bs.Prev=bs;if(!bt.IsOpen){this.SetHoleState(bv,bt)}bv.OutIdx=bt.Idx;return bs}else{var bt=this.m_PolyOuts[bv.OutIdx];var bx=bt.Pts;if(bw&&ar.IntPoint.op_Equality(bu,bx.Pt)){return bx}else{if(!bw&&ar.IntPoint.op_Equality(bu,bx.Prev.Pt)){return bx.Prev}}var bs=new ar.OutPt();bs.Idx=bt.Idx;bs.Pt.X=bu.X;bs.Pt.Y=bu.Y;bs.Next=bx;bs.Prev=bx.Prev;bs.Prev.Next=bs;bx.Prev=bs;if(bw){bt.Pts=bs}return bs}};ar.Clipper.prototype.SwapPoints=function(bu,bt){var bs=new ar.IntPoint(bu.Value);bu.Value.X=bt.Value.X;bu.Value.Y=bt.Value.Y;bt.Value.X=bs.X;bt.Value.Y=bs.Y};ar.Clipper.prototype.HorzSegmentsOverlap=function(bs,bv,bu,bt){if((bs.X>bu.X)==(bs.X<bt.X)){return true}else{if((bv.X>bu.X)==(bv.X<bt.X)){return true}else{if((bu.X>bs.X)==(bu.X<bv.X)){return true}else{if((bt.X>bs.X)==(bt.X<bv.X)){return true}else{if((bs.X==bu.X)&&(bv.X==bt.X)){return true}else{if((bs.X==bt.X)&&(bv.X==bu.X)){return true}else{return false}}}}}}};ar.Clipper.prototype.SetHoleState=function(bv,bu){var bt=false;var bs=bv.PrevInAEL;while(bs!==null){if(bs.OutIdx>=0&&bs.WindDelta!=0){bt=!bt;if(bu.FirstLeft===null){bu.FirstLeft=this.m_PolyOuts[bs.OutIdx]}}bs=bs.PrevInAEL}if(bt){bu.IsHole=true}};ar.Clipper.prototype.GetDx=function(bt,bs){if(bt.Y==bs.Y){return ar.ClipperBase.horizontal}else{return(bs.X-bt.X)/(bs.Y-bt.Y)}};ar.Clipper.prototype.FirstIsBottomPt=function(bu,bt){var bw=bu.Prev;while((ar.IntPoint.op_Equality(bw.Pt,bu.Pt))&&(bw!=bu)){bw=bw.Prev}var bv=Math.abs(this.GetDx(bu.Pt,bw.Pt));bw=bu.Next;while((ar.IntPoint.op_Equality(bw.Pt,bu.Pt))&&(bw!=bu)){bw=bw.Next}var by=Math.abs(this.GetDx(bu.Pt,bw.Pt));bw=bt.Prev;while((ar.IntPoint.op_Equality(bw.Pt,bt.Pt))&&(bw!=bt)){bw=bw.Prev}var bx=Math.abs(this.GetDx(bt.Pt,bw.Pt));bw=bt.Next;while((ar.IntPoint.op_Equality(bw.Pt,bt.Pt))&&(bw!=bt)){bw=bw.Next}var bs=Math.abs(this.GetDx(bt.Pt,bw.Pt));return(bv>=bx&&bv>=bs)||(by>=bx&&by>=bs)};ar.Clipper.prototype.GetBottomPt=function(bt){var bs=null;var bu=bt.Next;while(bu!=bt){if(bu.Pt.Y>bt.Pt.Y){bt=bu;bs=null}else{if(bu.Pt.Y==bt.Pt.Y&&bu.Pt.X<=bt.Pt.X){if(bu.Pt.X<bt.Pt.X){bs=null;bt=bu}else{if(bu.Next!=bt&&bu.Prev!=bt){bs=bu}}}}bu=bu.Next}if(bs!==null){while(bs!=bu){if(!this.FirstIsBottomPt(bu,bs)){bt=bs}bs=bs.Next;while(ar.IntPoint.op_Inequality(bs.Pt,bt.Pt)){bs=bs.Next}}}return bt};ar.Clipper.prototype.GetLowermostRec=function(bv,bt){if(bv.BottomPt===null){bv.BottomPt=this.GetBottomPt(bv.Pts)}if(bt.BottomPt===null){bt.BottomPt=this.GetBottomPt(bt.Pts)}var bu=bv.BottomPt;var bs=bt.BottomPt;if(bu.Pt.Y>bs.Pt.Y){return bv}else{if(bu.Pt.Y<bs.Pt.Y){return bt}else{if(bu.Pt.X<bs.Pt.X){return bv}else{if(bu.Pt.X>bs.Pt.X){return bt}else{if(bu.Next==bu){return bt}else{if(bs.Next==bs){return bv}else{if(this.FirstIsBottomPt(bu,bs)){return bv}else{return bt}}}}}}}};ar.Clipper.prototype.Param1RightOfParam2=function(bt,bs){do{bt=bt.FirstLeft;if(bt==bs){return true}}while(bt!==null);return false};ar.Clipper.prototype.GetOutRec=function(bs){var bt=this.m_PolyOuts[bs];while(bt!=this.m_PolyOuts[bt.Idx]){bt=this.m_PolyOuts[bt.Idx]}return bt};ar.Clipper.prototype.AppendPolygon=function(bC,bB){var bs=this.m_PolyOuts[bC.OutIdx];var bE=this.m_PolyOuts[bB.OutIdx];var bD;if(this.Param1RightOfParam2(bs,bE)){bD=bE}else{if(this.Param1RightOfParam2(bE,bs)){bD=bs}else{bD=this.GetLowermostRec(bs,bE)}}var bv=bs.Pts;var bx=bv.Prev;var bu=bE.Pts;var bt=bu.Prev;var bA;if(bC.Side==ar.EdgeSide.esLeft){if(bB.Side==ar.EdgeSide.esLeft){this.ReversePolyPtLinks(bu);bu.Next=bv;bv.Prev=bu;bx.Next=bt;bt.Prev=bx;bs.Pts=bt}else{bt.Next=bv;bv.Prev=bt;bu.Prev=bx;bx.Next=bu;bs.Pts=bu}bA=ar.EdgeSide.esLeft}else{if(bB.Side==ar.EdgeSide.esRight){this.ReversePolyPtLinks(bu);bx.Next=bt;bt.Prev=bx;bu.Next=bv;bv.Prev=bu}else{bx.Next=bu;bu.Prev=bx;bv.Prev=bt;bt.Next=bv}bA=ar.EdgeSide.esRight}bs.BottomPt=null;if(bD==bE){if(bE.FirstLeft!=bs){bs.FirstLeft=bE.FirstLeft}bs.IsHole=bE.IsHole}bE.Pts=null;bE.BottomPt=null;bE.FirstLeft=bs;var bw=bC.OutIdx;var by=bB.OutIdx;bC.OutIdx=-1;bB.OutIdx=-1;var bz=this.m_ActiveEdges;while(bz!==null){if(bz.OutIdx==by){bz.OutIdx=bw;bz.Side=bA;break}bz=bz.NextInAEL}bE.Idx=bs.Idx};ar.Clipper.prototype.ReversePolyPtLinks=function(bu){if(bu===null){return}var bt;var bs;bt=bu;do{bs=bt.Next;bt.Next=bt.Prev;bt.Prev=bs;bt=bs}while(bt!=bu)};ar.Clipper.SwapSides=function(bt,bs){var bu=bt.Side;bt.Side=bs.Side;bs.Side=bu};ar.Clipper.SwapPolyIndexes=function(bt,bs){var bu=bt.OutIdx;bt.OutIdx=bs.OutIdx;bs.OutIdx=bu};ar.Clipper.prototype.IntersectEdges=function(bD,bz,bH,bu){var bA=!bu&&bD.NextInLML===null&&bD.Top.X==bH.X&&bD.Top.Y==bH.Y;var bI=!bu&&bz.NextInLML===null&&bz.Top.X==bH.X&&bz.Top.Y==bH.Y;var bw=(bD.OutIdx>=0);var bE=(bz.OutIdx>=0);if(P){if(bD.WindDelta===0||bz.WindDelta===0){if(bD.WindDelta===0&&bz.WindDelta===0){if((bA||bI)&&bw&&bE){if(av){this.SetZ(bH,bD,bz)}this.AddLocalMaxPoly(bD,bz,bH)}}else{if(bD.PolyTyp==bz.PolyTyp&&bD.WindDelta!=bz.WindDelta&&this.m_ClipType==ar.ClipType.ctUnion){if(bD.WindDelta===0){if(bE){if(av){this.SetZ(bH,bD,bz)}this.AddOutPt(bD,bH);if(bw){bD.OutIdx=-1}}}else{if(bw){if(av){this.SetZ(bH,bD,bz)}this.AddOutPt(bz,bH);if(bE){bz.OutIdx=-1}}}}else{if(bD.PolyTyp!=bz.PolyTyp){if((bD.WindDelta===0)&&Math.abs(bz.WindCnt)==1&&(this.m_ClipType!=ar.ClipType.ctUnion||bz.WindCnt2===0)){if(av){this.SetZ(bH,bD,bz)}this.AddOutPt(bD,bH);if(bw){bD.OutIdx=-1}}else{if((bz.WindDelta===0)&&(Math.abs(bD.WindCnt)==1)&&(this.m_ClipType!=ar.ClipType.ctUnion||bD.WindCnt2===0)){if(av){this.SetZ(bH,bD,bz)}this.AddOutPt(bz,bH);if(bE){bz.OutIdx=-1}}}}}}if(bA){if(bD.OutIdx<0){this.DeleteFromAEL(bD)}else{ar.Error("Error intersecting polylines")}}if(bI){if(bz.OutIdx<0){this.DeleteFromAEL(bz)}else{ar.Error("Error intersecting polylines")}}return}}if(bD.PolyTyp==bz.PolyTyp){if(this.IsEvenOddFillType(bD)){var bt=bD.WindCnt;bD.WindCnt=bz.WindCnt;bz.WindCnt=bt}else{if(bD.WindCnt+bz.WindDelta===0){bD.WindCnt=-bD.WindCnt}else{bD.WindCnt+=bz.WindDelta}if(bz.WindCnt-bD.WindDelta===0){bz.WindCnt=-bz.WindCnt}else{bz.WindCnt-=bD.WindDelta}}}else{if(!this.IsEvenOddFillType(bz)){bD.WindCnt2+=bz.WindDelta}else{bD.WindCnt2=(bD.WindCnt2===0)?1:0}if(!this.IsEvenOddFillType(bD)){bz.WindCnt2-=bD.WindDelta}else{bz.WindCnt2=(bz.WindCnt2===0)?1:0}}var bG,bv,bs,by;if(bD.PolyTyp==ar.PolyType.ptSubject){bG=this.m_SubjFillType;bs=this.m_ClipFillType}else{bG=this.m_ClipFillType;bs=this.m_SubjFillType}if(bz.PolyTyp==ar.PolyType.ptSubject){bv=this.m_SubjFillType;by=this.m_ClipFillType}else{bv=this.m_ClipFillType;by=this.m_SubjFillType}var bC,bF;switch(bG){case ar.PolyFillType.pftPositive:bC=bD.WindCnt;break;case ar.PolyFillType.pftNegative:bC=-bD.WindCnt;break;default:bC=Math.abs(bD.WindCnt);break}switch(bv){case ar.PolyFillType.pftPositive:bF=bz.WindCnt;break;case ar.PolyFillType.pftNegative:bF=-bz.WindCnt;break;default:bF=Math.abs(bz.WindCnt);break}if(bw&&bE){if(bA||bI||(bC!==0&&bC!=1)||(bF!==0&&bF!=1)||(bD.PolyTyp!=bz.PolyTyp&&this.m_ClipType!=ar.ClipType.ctXor)){if(av){this.SetZ(bH,bD,bz)}this.AddLocalMaxPoly(bD,bz,bH)}else{if(av){this.SetZ(bH,bD,bz)}this.AddOutPt(bD,bH);this.AddOutPt(bz,bH);ar.Clipper.SwapSides(bD,bz);ar.Clipper.SwapPolyIndexes(bD,bz)}}else{if(bw){if(bF===0||bF==1){if(av){this.SetZ(bH,bD,bz)}this.AddOutPt(bD,bH);ar.Clipper.SwapSides(bD,bz);ar.Clipper.SwapPolyIndexes(bD,bz)}}else{if(bE){if(bC===0||bC==1){if(av){this.SetZ(bH,bD,bz)}this.AddOutPt(bz,bH);ar.Clipper.SwapSides(bD,bz);ar.Clipper.SwapPolyIndexes(bD,bz)}}else{if((bC===0||bC==1)&&(bF===0||bF==1)&&!bA&&!bI){var bB,bx;switch(bs){case ar.PolyFillType.pftPositive:bB=bD.WindCnt2;break;case ar.PolyFillType.pftNegative:bB=-bD.WindCnt2;break;default:bB=Math.abs(bD.WindCnt2);break}switch(by){case ar.PolyFillType.pftPositive:bx=bz.WindCnt2;break;case ar.PolyFillType.pftNegative:bx=-bz.WindCnt2;break;default:bx=Math.abs(bz.WindCnt2);break}if(bD.PolyTyp!=bz.PolyTyp){if(av){this.SetZ(bH,bD,bz)}this.AddLocalMinPoly(bD,bz,bH)}else{if(bC==1&&bF==1){switch(this.m_ClipType){case ar.ClipType.ctIntersection:if(bB>0&&bx>0){if(av){this.SetZ(bH,bD,bz)}this.AddLocalMinPoly(bD,bz,bH)}break;case ar.ClipType.ctUnion:if(bB<=0&&bx<=0){if(av){this.SetZ(bH,bD,bz)}this.AddLocalMinPoly(bD,bz,bH)}break;case ar.ClipType.ctDifference:if(((bD.PolyTyp==ar.PolyType.ptClip)&&(bB>0)&&(bx>0))||((bD.PolyTyp==ar.PolyType.ptSubject)&&(bB<=0)&&(bx<=0))){if(av){this.SetZ(bH,bD,bz)}this.AddLocalMinPoly(bD,bz,bH)}break;case ar.ClipType.ctXor:if(av){this.SetZ(bH,bD,bz)}this.AddLocalMinPoly(bD,bz,bH);break}}else{ar.Clipper.SwapSides(bD,bz)}}}}}}if((bA!=bI)&&((bA&&(bD.OutIdx>=0))||(bI&&(bz.OutIdx>=0)))){ar.Clipper.SwapSides(bD,bz);ar.Clipper.SwapPolyIndexes(bD,bz)}if(bA){this.DeleteFromAEL(bD)}if(bI){this.DeleteFromAEL(bz)}};ar.Clipper.prototype.DeleteFromAEL=function(bs){var bu=bs.PrevInAEL;var bt=bs.NextInAEL;if(bu===null&&bt===null&&(bs!=this.m_ActiveEdges)){return}if(bu!==null){bu.NextInAEL=bt}else{this.m_ActiveEdges=bt}if(bt!==null){bt.PrevInAEL=bu}bs.NextInAEL=null;bs.PrevInAEL=null};ar.Clipper.prototype.DeleteFromSEL=function(bu){var bt=bu.PrevInSEL;var bs=bu.NextInSEL;if(bt===null&&bs===null&&(bu!=this.m_SortedEdges)){return}if(bt!==null){bt.NextInSEL=bs}else{this.m_SortedEdges=bs}if(bs!==null){bs.PrevInSEL=bt}bu.NextInSEL=null;bu.PrevInSEL=null};ar.Clipper.prototype.UpdateEdgeIntoAEL=function(bs){if(bs.NextInLML===null){ar.Error("UpdateEdgeIntoAEL: invalid call")}var bu=bs.PrevInAEL;var bt=bs.NextInAEL;bs.NextInLML.OutIdx=bs.OutIdx;if(bu!==null){bu.NextInAEL=bs.NextInLML}else{this.m_ActiveEdges=bs.NextInLML}if(bt!==null){bt.PrevInAEL=bs.NextInLML}bs.NextInLML.Side=bs.Side;bs.NextInLML.WindDelta=bs.WindDelta;bs.NextInLML.WindCnt=bs.WindCnt;bs.NextInLML.WindCnt2=bs.WindCnt2;bs=bs.NextInLML;bs.Curr.X=bs.Bot.X;bs.Curr.Y=bs.Bot.Y;bs.PrevInAEL=bu;bs.NextInAEL=bt;if(!ar.ClipperBase.IsHorizontal(bs)){this.InsertScanbeam(bs.Top.Y)}return bs};ar.Clipper.prototype.ProcessHorizontals=function(bs){var bt=this.m_SortedEdges;while(bt!==null){this.DeleteFromSEL(bt);this.ProcessHorizontal(bt,bs);bt=this.m_SortedEdges}};ar.Clipper.prototype.GetHorzDirection=function(bt,bs){if(bt.Bot.X<bt.Top.X){bs.Left=bt.Bot.X;bs.Right=bt.Top.X;bs.Dir=ar.Direction.dLeftToRight}else{bs.Left=bt.Top.X;bs.Right=bt.Bot.X;bs.Dir=ar.Direction.dRightToLeft}};ar.Clipper.prototype.PrepareHorzJoins=function(bu,bs){var bt=this.m_PolyOuts[bu.OutIdx].Pts;if(bu.Side!=ar.EdgeSide.esLeft){bt=bt.Prev}if(bs){if(ar.IntPoint.op_Equality(bt.Pt,bu.Top)){this.AddGhostJoin(bt,bu.Bot)}else{this.AddGhostJoin(bt,bu.Top)}}};ar.Clipper.prototype.ProcessHorizontal=function(bz,bG){var bB={Dir:null,Left:null,Right:null};this.GetHorzDirection(bz,bB);var bx=bB.Dir;var bA=bB.Left;var bu=bB.Right;var by=bz,bD=null;while(by.NextInLML!==null&&ar.ClipperBase.IsHorizontal(by.NextInLML)){by=by.NextInLML}if(by.NextInLML===null){bD=this.GetMaximaPair(by)}for(;;){var bw=(bz==by);var bC=this.GetNextInAEL(bz,bx);while(bC!==null){if(bC.Curr.X==bz.Top.X&&bz.NextInLML!==null&&bC.Dx<bz.NextInLML.Dx){break}var bt=this.GetNextInAEL(bC,bx);if((bx==ar.Direction.dLeftToRight&&bC.Curr.X<=bu)||(bx==ar.Direction.dRightToLeft&&bC.Curr.X>=bA)){if(bz.OutIdx>=0&&bz.WindDelta!=0){this.PrepareHorzJoins(bz,bG)}if(bC==bD&&bw){if(bx==ar.Direction.dLeftToRight){this.IntersectEdges(bz,bC,bC.Top,false)}else{this.IntersectEdges(bC,bz,bC.Top,false)}if(bD.OutIdx>=0){ar.Error("ProcessHorizontal error")}return}else{if(bx==ar.Direction.dLeftToRight){var bv=new ar.IntPoint(bC.Curr.X,bz.Curr.Y);this.IntersectEdges(bz,bC,bv,true)}else{var bv=new ar.IntPoint(bC.Curr.X,bz.Curr.Y);this.IntersectEdges(bC,bz,bv,true)}}this.SwapPositionsInAEL(bz,bC)}else{if((bx==ar.Direction.dLeftToRight&&bC.Curr.X>=bu)||(bx==ar.Direction.dRightToLeft&&bC.Curr.X<=bA)){break}}bC=bt}if(bz.OutIdx>=0&&bz.WindDelta!==0){this.PrepareHorzJoins(bz,bG)}if(bz.NextInLML!==null&&ar.ClipperBase.IsHorizontal(bz.NextInLML)){bz=this.UpdateEdgeIntoAEL(bz);if(bz.OutIdx>=0){this.AddOutPt(bz,bz.Bot)}var bB={Dir:bx,Left:bA,Right:bu};this.GetHorzDirection(bz,bB);bx=bB.Dir;bA=bB.Left;bu=bB.Right}else{break}}if(bz.NextInLML!==null){if(bz.OutIdx>=0){var bs=this.AddOutPt(bz,bz.Top);bz=this.UpdateEdgeIntoAEL(bz);if(bz.WindDelta===0){return}var bE=bz.PrevInAEL;var bt=bz.NextInAEL;if(bE!==null&&bE.Curr.X==bz.Bot.X&&bE.Curr.Y==bz.Bot.Y&&bE.WindDelta!==0&&(bE.OutIdx>=0&&bE.Curr.Y>bE.Top.Y&&ar.ClipperBase.SlopesEqual(bz,bE,this.m_UseFullRange))){var bF=this.AddOutPt(bE,bz.Bot);this.AddJoin(bs,bF,bz.Top)}else{if(bt!==null&&bt.Curr.X==bz.Bot.X&&bt.Curr.Y==bz.Bot.Y&&bt.WindDelta!==0&&bt.OutIdx>=0&&bt.Curr.Y>bt.Top.Y&&ar.ClipperBase.SlopesEqual(bz,bt,this.m_UseFullRange)){var bF=this.AddOutPt(bt,bz.Bot);this.AddJoin(bs,bF,bz.Top)}}}else{bz=this.UpdateEdgeIntoAEL(bz)}}else{if(bD!==null){if(bD.OutIdx>=0){if(bx==ar.Direction.dLeftToRight){this.IntersectEdges(bz,bD,bz.Top,false)}else{this.IntersectEdges(bD,bz,bz.Top,false)}if(bD.OutIdx>=0){ar.Error("ProcessHorizontal error")}}else{this.DeleteFromAEL(bz);this.DeleteFromAEL(bD)}}else{if(bz.OutIdx>=0){this.AddOutPt(bz,bz.Top)}this.DeleteFromAEL(bz)}}};ar.Clipper.prototype.GetNextInAEL=function(bt,bs){return bs==ar.Direction.dLeftToRight?bt.NextInAEL:bt.PrevInAEL};ar.Clipper.prototype.IsMinima=function(bs){return bs!==null&&(bs.Prev.NextInLML!=bs)&&(bs.Next.NextInLML!=bs)};ar.Clipper.prototype.IsMaxima=function(bs,bt){return(bs!==null&&bs.Top.Y==bt&&bs.NextInLML===null)};ar.Clipper.prototype.IsIntermediate=function(bs,bt){return(bs.Top.Y==bt&&bs.NextInLML!==null)};ar.Clipper.prototype.GetMaximaPair=function(bt){var bs=null;if((ar.IntPoint.op_Equality(bt.Next.Top,bt.Top))&&bt.Next.NextInLML===null){bs=bt.Next}else{if((ar.IntPoint.op_Equality(bt.Prev.Top,bt.Top))&&bt.Prev.NextInLML===null){bs=bt.Prev}}if(bs!==null&&(bs.OutIdx==-2||(bs.NextInAEL==bs.PrevInAEL&&!ar.ClipperBase.IsHorizontal(bs)))){return null}return bs};ar.Clipper.prototype.ProcessIntersections=function(bu,bs){if(this.m_ActiveEdges==null){return true}try{this.BuildIntersectList(bu,bs);if(this.m_IntersectList.length==0){return true}if(this.m_IntersectList.length==1||this.FixupIntersectionOrder()){this.ProcessIntersectList()}else{return false}}catch(bt){this.m_SortedEdges=null;this.m_IntersectList.length=0;ar.Error("ProcessIntersections error")}this.m_SortedEdges=null;return true};ar.Clipper.prototype.BuildIntersectList=function(by,bt){if(this.m_ActiveEdges===null){return}var bx=this.m_ActiveEdges;this.m_SortedEdges=bx;while(bx!==null){bx.PrevInSEL=bx.PrevInAEL;bx.NextInSEL=bx.NextInAEL;bx.Curr.X=ar.Clipper.TopX(bx,bt);bx=bx.NextInAEL}var bs=true;while(bs&&this.m_SortedEdges!==null){bs=false;bx=this.m_SortedEdges;while(bx.NextInSEL!==null){var bu=bx.NextInSEL;var bw=new ar.IntPoint();if(bx.Curr.X>bu.Curr.X){if(!this.IntersectPoint(bx,bu,bw)&&bx.Curr.X>bu.Curr.X+1){ar.Error("Intersection error")}if(bw.Y>by){bw.Y=by;if(Math.abs(bx.Dx)>Math.abs(bu.Dx)){bw.X=ar.Clipper.TopX(bu,by)}else{bw.X=ar.Clipper.TopX(bx,by)}}var bv=new ar.IntersectNode();bv.Edge1=bx;bv.Edge2=bu;bv.Pt.X=bw.X;bv.Pt.Y=bw.Y;this.m_IntersectList.push(bv);this.SwapPositionsInSEL(bx,bu);bs=true}else{bx=bu}}if(bx.PrevInSEL!==null){bx.PrevInSEL.NextInSEL=null}else{break}}this.m_SortedEdges=null};ar.Clipper.prototype.EdgesAdjacent=function(bs){return(bs.Edge1.NextInSEL==bs.Edge2)||(bs.Edge1.PrevInSEL==bs.Edge2)};ar.Clipper.IntersectNodeSort=function(bt,bs){return(bs.Pt.Y-bt.Pt.Y)};ar.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer);this.CopyAELToSEL();var bv=this.m_IntersectList.length;for(var bu=0;bu<bv;bu++){if(!this.EdgesAdjacent(this.m_IntersectList[bu])){var bs=bu+1;while(bs<bv&&!this.EdgesAdjacent(this.m_IntersectList[bs])){bs++}if(bs==bv){return false}var bt=this.m_IntersectList[bu];this.m_IntersectList[bu]=this.m_IntersectList[bs];this.m_IntersectList[bs]=bt}this.SwapPositionsInSEL(this.m_IntersectList[bu].Edge1,this.m_IntersectList[bu].Edge2)}return true};ar.Clipper.prototype.ProcessIntersectList=function(){for(var bt=0,bs=this.m_IntersectList.length;bt<bs;bt++){var bu=this.m_IntersectList[bt];this.IntersectEdges(bu.Edge1,bu.Edge2,bu.Pt,true);this.SwapPositionsInAEL(bu.Edge1,bu.Edge2)}this.m_IntersectList.length=0};var ak=function(bs){return bs<0?Math.ceil(bs-0.5):Math.round(bs)};var aj=function(bs){return bs<0?Math.ceil(bs-0.5):Math.floor(bs+0.5)};var ai=function(bs){return bs<0?-Math.round(Math.abs(bs)):Math.round(bs)};var ag=function(bs){if(bs<0){bs-=0.5;return bs<-2147483648?Math.ceil(bs):bs|0}else{bs+=0.5;return bs>2147483647?Math.floor(bs):bs|0}};if(a2.msie){ar.Clipper.Round=ak}else{if(a2.chromium){ar.Clipper.Round=ai}else{if(a2.safari){ar.Clipper.Round=ag}else{ar.Clipper.Round=aj}}}ar.Clipper.TopX=function(bt,bs){if(bs==bt.Top.Y){return bt.Top.X}return bt.Bot.X+ar.Clipper.Round(bt.Dx*(bs-bt.Bot.Y))};ar.Clipper.prototype.IntersectPoint=function(bu,bs,bx){bx.X=0;bx.Y=0;var bv,bt;if(ar.ClipperBase.SlopesEqual(bu,bs,this.m_UseFullRange)||bu.Dx==bs.Dx){if(bs.Bot.Y>bu.Bot.Y){bx.X=bs.Bot.X;bx.Y=bs.Bot.Y}else{bx.X=bu.Bot.X;bx.Y=bu.Bot.Y}return false}else{if(bu.Delta.X===0){bx.X=bu.Bot.X;if(ar.ClipperBase.IsHorizontal(bs)){bx.Y=bs.Bot.Y}else{bt=bs.Bot.Y-(bs.Bot.X/bs.Dx);bx.Y=ar.Clipper.Round(bx.X/bs.Dx+bt)}}else{if(bs.Delta.X===0){bx.X=bs.Bot.X;if(ar.ClipperBase.IsHorizontal(bu)){bx.Y=bu.Bot.Y}else{bv=bu.Bot.Y-(bu.Bot.X/bu.Dx);bx.Y=ar.Clipper.Round(bx.X/bu.Dx+bv)}}else{bv=bu.Bot.X-bu.Bot.Y*bu.Dx;bt=bs.Bot.X-bs.Bot.Y*bs.Dx;var bw=(bt-bv)/(bu.Dx-bs.Dx);bx.Y=ar.Clipper.Round(bw);if(Math.abs(bu.Dx)<Math.abs(bs.Dx)){bx.X=ar.Clipper.Round(bu.Dx*bw+bv)}else{bx.X=ar.Clipper.Round(bs.Dx*bw+bt)}}}}if(bx.Y<bu.Top.Y||bx.Y<bs.Top.Y){if(bu.Top.Y>bs.Top.Y){bx.Y=bu.Top.Y;bx.X=ar.Clipper.TopX(bs,bu.Top.Y);return bx.X<bu.Top.X}else{bx.Y=bs.Top.Y}if(Math.abs(bu.Dx)>Math.abs(bs.Dx)){bx.X=ar.Clipper.TopX(bs,bx.Y)}else{bx.X=ar.Clipper.TopX(bu,bx.Y)}}return true};ar.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(bt){var bw=this.m_ActiveEdges;while(bw!==null){var bA=this.IsMaxima(bw,bt);if(bA){var bx=this.GetMaximaPair(bw);bA=(bx===null||!ar.ClipperBase.IsHorizontal(bx))}if(bA){var by=bw.PrevInAEL;this.DoMaxima(bw);if(by===null){bw=this.m_ActiveEdges}else{bw=by.NextInAEL}}else{if(this.IsIntermediate(bw,bt)&&ar.ClipperBase.IsHorizontal(bw.NextInLML)){bw=this.UpdateEdgeIntoAEL(bw);if(bw.OutIdx>=0){this.AddOutPt(bw,bw.Bot)}this.AddEdgeToSEL(bw)}else{bw.Curr.X=ar.Clipper.TopX(bw,bt);bw.Curr.Y=bt}if(this.StrictlySimple){var by=bw.PrevInAEL;if((bw.OutIdx>=0)&&(bw.WindDelta!==0)&&by!==null&&(by.OutIdx>=0)&&(by.Curr.X==bw.Curr.X)&&(by.WindDelta!==0)){var bv=new ar.IntPoint(bw.Curr);if(av){this.SetZ(bv,by,bw)}var bu=this.AddOutPt(by,bv);var bz=this.AddOutPt(bw,bv);this.AddJoin(bu,bz,bv)}}bw=bw.NextInAEL}}this.ProcessHorizontals(true);bw=this.m_ActiveEdges;while(bw!==null){if(this.IsIntermediate(bw,bt)){var bu=null;if(bw.OutIdx>=0){bu=this.AddOutPt(bw,bw.Top)}bw=this.UpdateEdgeIntoAEL(bw);var by=bw.PrevInAEL;var bs=bw.NextInAEL;if(by!==null&&by.Curr.X==bw.Bot.X&&by.Curr.Y==bw.Bot.Y&&bu!==null&&by.OutIdx>=0&&by.Curr.Y>by.Top.Y&&ar.ClipperBase.SlopesEqual(bw,by,this.m_UseFullRange)&&(bw.WindDelta!==0)&&(by.WindDelta!==0)){var bz=this.AddOutPt(by,bw.Bot);this.AddJoin(bu,bz,bw.Top)}else{if(bs!==null&&bs.Curr.X==bw.Bot.X&&bs.Curr.Y==bw.Bot.Y&&bu!==null&&bs.OutIdx>=0&&bs.Curr.Y>bs.Top.Y&&ar.ClipperBase.SlopesEqual(bw,bs,this.m_UseFullRange)&&(bw.WindDelta!==0)&&(bs.WindDelta!==0)){var bz=this.AddOutPt(bs,bw.Bot);this.AddJoin(bu,bz,bw.Top)}}}bw=bw.NextInAEL}};ar.Clipper.prototype.DoMaxima=function(bv){var bu=this.GetMaximaPair(bv);if(bu===null){if(bv.OutIdx>=0){this.AddOutPt(bv,bv.Top)}this.DeleteFromAEL(bv);return}var bt=bv.NextInAEL;var bs=true;while(bt!==null&&bt!=bu){this.IntersectEdges(bv,bt,bv.Top,true);this.SwapPositionsInAEL(bv,bt);bt=bv.NextInAEL}if(bv.OutIdx==-1&&bu.OutIdx==-1){this.DeleteFromAEL(bv);this.DeleteFromAEL(bu)}else{if(bv.OutIdx>=0&&bu.OutIdx>=0){this.IntersectEdges(bv,bu,bv.Top,false)}else{if(bs&&bv.WindDelta===0){if(bv.OutIdx>=0){this.AddOutPt(bv,bv.Top);bv.OutIdx=-1}this.DeleteFromAEL(bv);if(bu.OutIdx>=0){this.AddOutPt(bu,bv.Top);bu.OutIdx=-1}this.DeleteFromAEL(bu)}else{ar.Error("DoMaxima error")}}}};ar.Clipper.ReversePaths=function(bt){for(var bu=0,bs=bt.length;bu<bs;bu++){bt[bu].reverse()}};ar.Clipper.Orientation=function(bs){return ar.Clipper.Area(bs)>=0};ar.Clipper.prototype.PointCount=function(bu){if(bu===null){return 0}var bs=0;var bt=bu;do{bs++;bt=bt.Next}while(bt!=bu);return bs};ar.Clipper.prototype.BuildResult=function(bs){ar.Clear(bs);for(var bw=0,bv=this.m_PolyOuts.length;bw<bv;bw++){var by=this.m_PolyOuts[bw];if(by.Pts===null){continue}var bx=by.Pts.Prev;var bu=this.PointCount(bx);if(bu<2){continue}var bz=new Array(bu);for(var bt=0;bt<bu;bt++){bz[bt]=bx.Pt;bx=bx.Prev}bs.push(bz)}};ar.Clipper.prototype.BuildResult2=function(bs){bs.Clear();for(var bx=0,bw=this.m_PolyOuts.length;bx<bw;bx++){var by=this.m_PolyOuts[bx];var bv=this.PointCount(by.Pts);if((by.IsOpen&&bv<2)||(!by.IsOpen&&bv<3)){continue}this.FixHoleLinkage(by);var bu=new ar.PolyNode();bs.m_AllPolys.push(bu);by.PolyNode=bu;bu.m_polygon.length=bv;var bz=by.Pts.Prev;for(var bt=0;bt<bv;bt++){bu.m_polygon[bt]=bz.Pt;bz=bz.Prev}}for(var bx=0,bw=this.m_PolyOuts.length;bx<bw;bx++){var by=this.m_PolyOuts[bx];if(by.PolyNode===null){continue}else{if(by.IsOpen){by.PolyNode.IsOpen=true;bs.AddChild(by.PolyNode)}else{if(by.FirstLeft!==null&&by.FirstLeft.PolyNode!=null){by.FirstLeft.PolyNode.AddChild(by.PolyNode)}else{bs.AddChild(by.PolyNode)}}}}};ar.Clipper.prototype.FixupOutPolygon=function(bv){var bt=null;bv.BottomPt=null;var bs=bv.Pts;for(;;){if(bs.Prev==bs||bs.Prev==bs.Next){this.DisposeOutPts(bs);bv.Pts=null;return}if((ar.IntPoint.op_Equality(bs.Pt,bs.Next.Pt))||(ar.IntPoint.op_Equality(bs.Pt,bs.Prev.Pt))||(ar.ClipperBase.SlopesEqual(bs.Prev.Pt,bs.Pt,bs.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(bs.Prev.Pt,bs.Pt,bs.Next.Pt)))){bt=null;var bu=bs;bs.Prev.Next=bs.Next;bs.Next.Prev=bs.Prev;bs=bs.Prev;bu=null}else{if(bs==bt){break}else{if(bt===null){bt=bs}bs=bs.Next}}}bv.Pts=bs};ar.Clipper.prototype.DupOutPt=function(bt,bu){var bs=new ar.OutPt();bs.Pt.X=bt.Pt.X;bs.Pt.Y=bt.Pt.Y;bs.Idx=bt.Idx;if(bu){bs.Next=bt.Next;bs.Prev=bt;bt.Next.Prev=bs;bt.Next=bs}else{bs.Prev=bt.Prev;bs.Next=bt;bt.Prev.Next=bs;bt.Prev=bs}return bs};ar.Clipper.prototype.GetOverlap=function(bu,bt,bw,bv,bs){if(bu<bt){if(bw<bv){bs.Left=Math.max(bu,bw);bs.Right=Math.min(bt,bv)}else{bs.Left=Math.max(bu,bv);bs.Right=Math.min(bt,bw)}}else{if(bw<bv){bs.Left=Math.max(bt,bw);bs.Right=Math.min(bu,bv)}else{bs.Left=Math.max(bt,bv);bs.Right=Math.min(bu,bw)}}return bs.Left<bs.Right};ar.Clipper.prototype.JoinHorz=function(bw,bz,bu,bs,by,bx){var bv=(bw.Pt.X>bz.Pt.X?ar.Direction.dRightToLeft:ar.Direction.dLeftToRight);var bt=(bu.Pt.X>bs.Pt.X?ar.Direction.dRightToLeft:ar.Direction.dLeftToRight);if(bv==bt){return false}if(bv==ar.Direction.dLeftToRight){while(bw.Next.Pt.X<=by.X&&bw.Next.Pt.X>=bw.Pt.X&&bw.Next.Pt.Y==by.Y){bw=bw.Next}if(bx&&(bw.Pt.X!=by.X)){bw=bw.Next}bz=this.DupOutPt(bw,!bx);if(ar.IntPoint.op_Inequality(bz.Pt,by)){bw=bz;bw.Pt.X=by.X;bw.Pt.Y=by.Y;bz=this.DupOutPt(bw,!bx)}}else{while(bw.Next.Pt.X>=by.X&&bw.Next.Pt.X<=bw.Pt.X&&bw.Next.Pt.Y==by.Y){bw=bw.Next}if(!bx&&(bw.Pt.X!=by.X)){bw=bw.Next}bz=this.DupOutPt(bw,bx);if(ar.IntPoint.op_Inequality(bz.Pt,by)){bw=bz;bw.Pt.X=by.X;bw.Pt.Y=by.Y;bz=this.DupOutPt(bw,bx)}}if(bt==ar.Direction.dLeftToRight){while(bu.Next.Pt.X<=by.X&&bu.Next.Pt.X>=bu.Pt.X&&bu.Next.Pt.Y==by.Y){bu=bu.Next}if(bx&&(bu.Pt.X!=by.X)){bu=bu.Next}bs=this.DupOutPt(bu,!bx);if(ar.IntPoint.op_Inequality(bs.Pt,by)){bu=bs;bu.Pt.X=by.X;bu.Pt.Y=by.Y;bs=this.DupOutPt(bu,!bx)}}else{while(bu.Next.Pt.X>=by.X&&bu.Next.Pt.X<=bu.Pt.X&&bu.Next.Pt.Y==by.Y){bu=bu.Next}if(!bx&&(bu.Pt.X!=by.X)){bu=bu.Next}bs=this.DupOutPt(bu,bx);if(ar.IntPoint.op_Inequality(bs.Pt,by)){bu=bs;bu.Pt.X=by.X;bu.Pt.Y=by.Y;bs=this.DupOutPt(bu,bx)}}if((bv==ar.Direction.dLeftToRight)==bx){bw.Prev=bu;bu.Next=bw;bz.Next=bs;bs.Prev=bz}else{bw.Next=bu;bu.Prev=bw;bz.Prev=bs;bs.Next=bz}return true};ar.Clipper.prototype.JoinPoints=function(by,bs,bH){var bt=by.OutPt1,bu=new ar.OutPt();var bI=by.OutPt2,bE=new ar.OutPt();var bF=(by.OutPt1.Pt.Y==by.OffPt.Y);if(bF&&(ar.IntPoint.op_Equality(by.OffPt,by.OutPt1.Pt))&&(ar.IntPoint.op_Equality(by.OffPt,by.OutPt2.Pt))){if(bs!=bH){return false}bu=by.OutPt1.Next;while(bu!=bt&&(ar.IntPoint.op_Equality(bu.Pt,by.OffPt))){bu=bu.Next}var bD=(bu.Pt.Y>by.OffPt.Y);bE=by.OutPt2.Next;while(bE!=bI&&(ar.IntPoint.op_Equality(bE.Pt,by.OffPt))){bE=bE.Next}var bA=(bE.Pt.Y>by.OffPt.Y);if(bD==bA){return false}if(bD){bu=this.DupOutPt(bt,false);bE=this.DupOutPt(bI,true);bt.Prev=bI;bI.Next=bt;bu.Next=bE;bE.Prev=bu;by.OutPt1=bt;by.OutPt2=bu;return true}else{bu=this.DupOutPt(bt,true);bE=this.DupOutPt(bI,false);bt.Next=bI;bI.Prev=bt;bu.Prev=bE;bE.Next=bu;by.OutPt1=bt;by.OutPt2=bu;return true}}else{if(bF){bu=bt;while(bt.Prev.Pt.Y==bt.Pt.Y&&bt.Prev!=bu&&bt.Prev!=bI){bt=bt.Prev}while(bu.Next.Pt.Y==bu.Pt.Y&&bu.Next!=bt&&bu.Next!=bI){bu=bu.Next}if(bu.Next==bt||bu.Next==bI){return false}bE=bI;while(bI.Prev.Pt.Y==bI.Pt.Y&&bI.Prev!=bE&&bI.Prev!=bu){bI=bI.Prev}while(bE.Next.Pt.Y==bE.Pt.Y&&bE.Next!=bI&&bE.Next!=bt){bE=bE.Next}if(bE.Next==bI||bE.Next==bt){return false}var bG={Left:null,Right:null};if(!this.GetOverlap(bt.Pt.X,bu.Pt.X,bI.Pt.X,bE.Pt.X,bG)){return false}var bz=bG.Left;var bC=bG.Right;var bv=new ar.IntPoint();var bB;if(bt.Pt.X>=bz&&bt.Pt.X<=bC){bv.X=bt.Pt.X;bv.Y=bt.Pt.Y;bB=(bt.Pt.X>bu.Pt.X)}else{if(bI.Pt.X>=bz&&bI.Pt.X<=bC){bv.X=bI.Pt.X;bv.Y=bI.Pt.Y;bB=(bI.Pt.X>bE.Pt.X)}else{if(bu.Pt.X>=bz&&bu.Pt.X<=bC){bv.X=bu.Pt.X;bv.Y=bu.Pt.Y;bB=bu.Pt.X>bt.Pt.X}else{bv.X=bE.Pt.X;bv.Y=bE.Pt.Y;bB=(bE.Pt.X>bI.Pt.X)}}}by.OutPt1=bt;by.OutPt2=bI;return this.JoinHorz(bt,bu,bI,bE,bv,bB)}else{bu=bt.Next;while((ar.IntPoint.op_Equality(bu.Pt,bt.Pt))&&(bu!=bt)){bu=bu.Next}var bx=((bu.Pt.Y>bt.Pt.Y)||!ar.ClipperBase.SlopesEqual(bt.Pt,bu.Pt,by.OffPt,this.m_UseFullRange));if(bx){bu=bt.Prev;while((ar.IntPoint.op_Equality(bu.Pt,bt.Pt))&&(bu!=bt)){bu=bu.Prev}if((bu.Pt.Y>bt.Pt.Y)||!ar.ClipperBase.SlopesEqual(bt.Pt,bu.Pt,by.OffPt,this.m_UseFullRange)){return false}}bE=bI.Next;while((ar.IntPoint.op_Equality(bE.Pt,bI.Pt))&&(bE!=bI)){bE=bE.Next}var bw=((bE.Pt.Y>bI.Pt.Y)||!ar.ClipperBase.SlopesEqual(bI.Pt,bE.Pt,by.OffPt,this.m_UseFullRange));if(bw){bE=bI.Prev;while((ar.IntPoint.op_Equality(bE.Pt,bI.Pt))&&(bE!=bI)){bE=bE.Prev}if((bE.Pt.Y>bI.Pt.Y)||!ar.ClipperBase.SlopesEqual(bI.Pt,bE.Pt,by.OffPt,this.m_UseFullRange)){return false}}if((bu==bt)||(bE==bI)||(bu==bE)||((bs==bH)&&(bx==bw))){return false}if(bx){bu=this.DupOutPt(bt,false);bE=this.DupOutPt(bI,true);bt.Prev=bI;bI.Next=bt;bu.Next=bE;bE.Prev=bu;by.OutPt1=bt;by.OutPt2=bu;return true}else{bu=this.DupOutPt(bt,true);bE=this.DupOutPt(bI,false);bt.Next=bI;bI.Prev=bt;bu.Prev=bE;bE.Next=bu;by.OutPt1=bt;by.OutPt2=bu;return true}}}};ar.Clipper.GetBounds=function(bx){var bw=0,bv=bx.length;while(bw<bv&&bx[bw].length==0){bw++}if(bw==bv){return new ar.IntRect(0,0,0,0)}var bs=new ar.IntRect();bs.left=bx[bw][0].X;bs.right=bs.left;bs.top=bx[bw][0].Y;bs.bottom=bs.top;for(;bw<bv;bw++){for(var bu=0,bt=bx[bw].length;bu<bt;bu++){if(bx[bw][bu].X<bs.left){bs.left=bx[bw][bu].X}else{if(bx[bw][bu].X>bs.right){bs.right=bx[bw][bu].X}}if(bx[bw][bu].Y<bs.top){bs.top=bx[bw][bu].Y}else{if(bx[bw][bu].Y>bs.bottom){bs.bottom=bx[bw][bu].Y}}}}return bs};ar.Clipper.prototype.GetBounds2=function(bu){var bt=bu;var bs=new ar.IntRect();bs.left=bu.Pt.X;bs.right=bu.Pt.X;bs.top=bu.Pt.Y;bs.bottom=bu.Pt.Y;bu=bu.Next;while(bu!=bt){if(bu.Pt.X<bs.left){bs.left=bu.Pt.X}if(bu.Pt.X>bs.right){bs.right=bu.Pt.X}if(bu.Pt.Y<bs.top){bs.top=bu.Pt.Y}if(bu.Pt.Y>bs.bottom){bs.bottom=bu.Pt.Y}bu=bu.Next}return bs};ar.Clipper.PointInPolygon=function(bw,bv){var bs=0,bu=bv.length;if(bu<3){return 0}var by=bv[0];for(var bt=1;bt<=bu;++bt){var bz=(bt==bu?bv[0]:bv[bt]);if(bz.Y==bw.Y){if((bz.X==bw.X)||(by.Y==bw.Y&&((bz.X>bw.X)==(by.X<bw.X)))){return -1}}if((by.Y<bw.Y)!=(bz.Y<bw.Y)){if(by.X>=bw.X){if(bz.X>bw.X){bs=1-bs}else{var bx=(by.X-bw.X)*(bz.Y-bw.Y)-(bz.X-bw.X)*(by.Y-bw.Y);if(bx==0){return -1}else{if((bx>0)==(bz.Y>by.Y)){bs=1-bs}}}}else{if(bz.X>bw.X){var bx=(by.X-bw.X)*(bz.Y-bw.Y)-(bz.X-bw.X)*(by.Y-bw.Y);if(bx==0){return -1}else{if((bx>0)==(bz.Y>by.Y)){bs=1-bs}}}}}by=bz}return bs};ar.Clipper.prototype.PointInPolygon=function(bB,bt){var bC=0;var by=bt;var bx=bB.X,bw=bB.Y;var bA=bt.Pt.X,bz=bt.Pt.Y;do{bt=bt.Next;var bu=bt.Pt.X,bs=bt.Pt.Y;if(bs==bw){if((bu==bx)||(bz==bw&&((bu>bx)==(bA<bx)))){return -1}}if((bz<bw)!=(bs<bw)){if(bA>=bx){if(bu>bx){bC=1-bC}else{var bv=(bA-bx)*(bs-bw)-(bu-bx)*(bz-bw);if(bv==0){return -1}if((bv>0)==(bs>bz)){bC=1-bC}}}else{if(bu>bx){var bv=(bA-bx)*(bs-bw)-(bu-bx)*(bz-bw);if(bv==0){return -1}if((bv>0)==(bs>bz)){bC=1-bC}}}}bA=bu;bz=bs}while(by!=bt);return bC};ar.Clipper.prototype.Poly2ContainsPoly1=function(bu,bt){var bv=bu;do{var bs=this.PointInPolygon(bv.Pt,bt);if(bs>=0){return bs!=0}bv=bv.Next}while(bv!=bu);return true};ar.Clipper.prototype.FixupFirstLefts1=function(bu,bw){for(var bt=0,bs=this.m_PolyOuts.length;bt<bs;bt++){var bv=this.m_PolyOuts[bt];if(bv.Pts!==null&&bv.FirstLeft==bu){if(this.Poly2ContainsPoly1(bv.Pts,bw.Pts)){bv.FirstLeft=bw}}}};ar.Clipper.prototype.FixupFirstLefts2=function(bu,bw){for(var bt=0,bs=this.m_PolyOuts,bx=bs.length,bv=bs[bt];bt<bx;bt++,bv=bs[bt]){if(bv.FirstLeft==bu){bv.FirstLeft=bw}}};ar.Clipper.ParseFirstLeft=function(bs){while(bs!=null&&bs.Pts==null){bs=bs.FirstLeft}return bs};ar.Clipper.prototype.JoinCommonEdges=function(){for(var bx=0,bu=this.m_Joins.length;bx<bu;bx++){var bt=this.m_Joins[bx];var bs=this.GetOutRec(bt.OutPt1.Idx);var bA=this.GetOutRec(bt.OutPt2.Idx);if(bs.Pts==null||bA.Pts==null){continue}var by;if(bs==bA){by=bs}else{if(this.Param1RightOfParam2(bs,bA)){by=bA}else{if(this.Param1RightOfParam2(bA,bs)){by=bs}else{by=this.GetLowermostRec(bs,bA)}}}if(!this.JoinPoints(bt,bs,bA)){continue}if(bs==bA){bs.Pts=bt.OutPt1;bs.BottomPt=null;bA=this.CreateOutRec();bA.Pts=bt.OutPt2;this.UpdateOutPtIdxs(bA);if(this.m_UsingPolyTree){for(var bv=0,bz=this.m_PolyOuts.length;bv<bz-1;bv++){var bw=this.m_PolyOuts[bv];if(bw.Pts==null||ar.Clipper.ParseFirstLeft(bw.FirstLeft)!=bs||bw.IsHole==bs.IsHole){continue}if(this.Poly2ContainsPoly1(bw.Pts,bt.OutPt2)){bw.FirstLeft=bA}}}if(this.Poly2ContainsPoly1(bA.Pts,bs.Pts)){bA.IsHole=!bs.IsHole;bA.FirstLeft=bs;if(this.m_UsingPolyTree){this.FixupFirstLefts2(bA,bs)}if((bA.IsHole^this.ReverseSolution)==(this.Area(bA)>0)){this.ReversePolyPtLinks(bA.Pts)}}else{if(this.Poly2ContainsPoly1(bs.Pts,bA.Pts)){bA.IsHole=bs.IsHole;bs.IsHole=!bA.IsHole;bA.FirstLeft=bs.FirstLeft;bs.FirstLeft=bA;if(this.m_UsingPolyTree){this.FixupFirstLefts2(bs,bA)}if((bs.IsHole^this.ReverseSolution)==(this.Area(bs)>0)){this.ReversePolyPtLinks(bs.Pts)}}else{bA.IsHole=bs.IsHole;bA.FirstLeft=bs.FirstLeft;if(this.m_UsingPolyTree){this.FixupFirstLefts1(bs,bA)}}}}else{bA.Pts=null;bA.BottomPt=null;bA.Idx=bs.Idx;bs.IsHole=by.IsHole;if(by==bA){bs.FirstLeft=bA.FirstLeft}bA.FirstLeft=bs;if(this.m_UsingPolyTree){this.FixupFirstLefts2(bA,bs)}}}};ar.Clipper.prototype.UpdateOutPtIdxs=function(bs){var bt=bs.Pts;do{bt.Idx=bs.Idx;bt=bt.Prev}while(bt!=bs.Pts)};ar.Clipper.prototype.DoSimplePolygons=function(){var bw=0;while(bw<this.m_PolyOuts.length){var bs=this.m_PolyOuts[bw++];var by=bs.Pts;if(by===null||bs.IsOpen){continue}do{var bv=by.Next;while(bv!=bs.Pts){if((ar.IntPoint.op_Equality(by.Pt,bv.Pt))&&bv.Next!=by&&bv.Prev!=by){var bu=by.Prev;var bt=bv.Prev;by.Prev=bt;bt.Next=by;bv.Prev=bu;bu.Next=bv;bs.Pts=by;var bx=this.CreateOutRec();bx.Pts=bv;this.UpdateOutPtIdxs(bx);if(this.Poly2ContainsPoly1(bx.Pts,bs.Pts)){bx.IsHole=!bs.IsHole;bx.FirstLeft=bs}else{if(this.Poly2ContainsPoly1(bs.Pts,bx.Pts)){bx.IsHole=bs.IsHole;bs.IsHole=!bx.IsHole;bx.FirstLeft=bs.FirstLeft;bs.FirstLeft=bx}else{bx.IsHole=bs.IsHole;bx.FirstLeft=bs.FirstLeft}}bv=by}bv=bv.Next}by=by.Next}while(by!=bs.Pts)}};ar.Clipper.Area=function(bw){var bv=bw.length;if(bv<3){return 0}var bs=0;for(var bu=0,bt=bv-1;bu<bv;++bu){bs+=(bw[bt].X+bw[bu].X)*(bw[bt].Y-bw[bu].Y);bt=bu}return -bs*0.5};ar.Clipper.prototype.Area=function(bt){var bu=bt.Pts;if(bu==null){return 0}var bs=0;do{bs=bs+(bu.Prev.Pt.X+bu.Pt.X)*(bu.Prev.Pt.Y-bu.Pt.Y);bu=bu.Next}while(bu!=bt.Pts);return bs*0.5};if(aV){ar.Clipper.OffsetPaths=function(bu,by,bt,bv,bw){var bs=new ar.Paths();var bx=new ar.ClipperOffset(bw,bw);bx.AddPaths(bu,bt,bv);bx.Execute(bs,by);return bs}}ar.Clipper.SimplifyPolygon=function(bt,bv){var bs=new Array();var bu=new ar.Clipper(0);bu.StrictlySimple=true;bu.AddPath(bt,ar.PolyType.ptSubject,true);bu.Execute(ar.ClipType.ctUnion,bs,bv,bv);return bs};ar.Clipper.SimplifyPolygons=function(bt,bv){if(typeof(bv)=="undefined"){bv=ar.PolyFillType.pftEvenOdd}var bs=new Array();var bu=new ar.Clipper(0);bu.StrictlySimple=true;bu.AddPaths(bt,ar.PolyType.ptSubject,true);bu.Execute(ar.ClipType.ctUnion,bs,bv,bv);return bs};ar.Clipper.DistanceSqrd=function(bv,bu){var bt=(bv.X-bu.X);var bs=(bv.Y-bu.Y);return(bt*bt+bs*bs)};ar.Clipper.DistanceFromLineSqrd=function(bv,bu,bt){var bs=bu.Y-bt.Y;var bx=bt.X-bu.X;var bw=bs*bu.X+bx*bu.Y;bw=bs*bv.X+bx*bv.Y-bw;return(bw*bw)/(bs*bs+bx*bx)};ar.Clipper.SlopesNearCollinear=function(bv,bu,bt,bs){return ar.Clipper.DistanceFromLineSqrd(bu,bv,bt)<bs};ar.Clipper.PointsAreClose=function(bw,bv,bu){var bt=bw.X-bv.X;var bs=bw.Y-bv.Y;return((bt*bt)+(bs*bs)<=bu)};ar.Clipper.ExcludeOp=function(bt){var bs=bt.Prev;bs.Next=bt.Next;bt.Next.Prev=bs;bs.Idx=0;return bs};ar.Clipper.CleanPolygon=function(bx,bz){if(typeof(bz)=="undefined"){bz=1.415}var bu=bx.length;if(bu==0){return new Array()}var bw=new Array(bu);for(var bt=0;bt<bu;++bt){bw[bt]=new ar.OutPt()}for(var bt=0;bt<bu;++bt){bw[bt].Pt=bx[bt];bw[bt].Next=bw[(bt+1)%bu];bw[bt].Next.Prev=bw[bt];bw[bt].Idx=0}var bv=bz*bz;var by=bw[0];while(by.Idx==0&&by.Next!=by.Prev){if(ar.Clipper.PointsAreClose(by.Pt,by.Prev.Pt,bv)){by=ar.Clipper.ExcludeOp(by);bu--}else{if(ar.Clipper.PointsAreClose(by.Prev.Pt,by.Next.Pt,bv)){ar.Clipper.ExcludeOp(by.Next);by=ar.Clipper.ExcludeOp(by);bu-=2}else{if(ar.Clipper.SlopesNearCollinear(by.Prev.Pt,by.Pt,by.Next.Pt,bv)){by=ar.Clipper.ExcludeOp(by);bu--}else{by.Idx=1;by=by.Next}}}}if(bu<3){bu=0}var bs=new Array(bu);for(var bt=0;bt<bu;++bt){bs[bt]=new ar.IntPoint(by.Pt);by=by.Next}bw=null;return bs};ar.Clipper.CleanPolygons=function(bt,bw){var bs=new Array(bt.length);for(var bv=0,bu=bt.length;bv<bu;bv++){bs[bv]=ar.Clipper.CleanPolygon(bt[bv],bw)}return bs};ar.Clipper.Minkowski=function(bz,bF,bu,bD){var bB=(bD?1:0);var bs=bz.length;var bx=bF.length;var bG=new Array();if(bu){for(var bw=0;bw<bx;bw++){var bt=new Array(bs);for(var bv=0,bC=bz.length,by=bz[bv];bv<bC;bv++,by=bz[bv]){bt[bv]=new ar.IntPoint(bF[bw].X+by.X,bF[bw].Y+by.Y)}bG.push(bt)}}else{for(var bw=0;bw<bx;bw++){var bt=new Array(bs);for(var bv=0,bC=bz.length,by=bz[bv];bv<bC;bv++,by=bz[bv]){bt[bv]=new ar.IntPoint(bF[bw].X-by.X,bF[bw].Y-by.Y)}bG.push(bt)}}var bE=new Array();for(var bw=0;bw<bx-1+bB;bw++){for(var bv=0;bv<bs;bv++){var bA=new Array();bA.push(bG[bw%bx][bv%bs]);bA.push(bG[(bw+1)%bx][bv%bs]);bA.push(bG[(bw+1)%bx][(bv+1)%bs]);bA.push(bG[bw%bx][(bv+1)%bs]);if(!ar.Clipper.Orientation(bA)){bA.reverse()}bE.push(bA)}}return bE};ar.Clipper.TranslatePath=function(bt,bv){var bu=[];for(var bs=0;bs<bt.length;bs++){bu.push(new ar.IntPoint(bt[bs].X+bv.X,bt[bs].Y+bv.Y))}return bu};ar.Clipper.MinkowskiSum=function(){var bB=arguments,bt=bB.length;if(bt==3){var by=bB[0],bD=bB[1],bw=bB[2];var bC=ar.Clipper.Minkowski(by,bD,true,bw);var bz=new ar.Clipper(0);bz.AddPaths(bC,ar.PolyType.ptSubject,true);bz.Execute(ar.ClipType.ctUnion,bC,ar.PolyFillType.pftNonZero,ar.PolyFillType.pftNonZero);return bC}else{if(bt==4){var by=bB[0],bC=bB[1],bA=bB[2],bw=bB[3];var bx=new ar.Paths();var bz=new ar.Clipper(),bv;for(var bu=0,bs=bC.length;bu<bs;++bu){var bv=ar.Clipper.Minkowski(by,bC[bu],true,bw);bz.AddPaths(bv,ar.PolyType.ptSubject,true);if(bw){var bD=ar.Clipper.TranslatePath(bC[bu],by[0]);bz.AddPath(bD,ar.PolyType.ptClip,true)}}bz.Execute(ar.ClipType.ctUnion,bx,bA,bA);return bx}}};ar.Clipper.MinkowskiDiff=function(bt,bu,bs){var bv=ar.Clipper.Minkowski(bt,bu,false,bs);var bw=new ar.Clipper(0);bw.AddPaths(bv,ar.PolyType.ptSubject,true);bw.Execute(ar.ClipType.ctUnion,bv,ar.PolyFillType.pftNonZero,ar.PolyFillType.pftNonZero);return bv};ar.Clipper.PolyTreeToPaths=function(bt){var bs=new Array();ar.Clipper.AddPolyNodeToPaths(bt,ar.Clipper.NodeType.ntAny,bs);return bs};ar.Clipper.AddPolyNodeToPaths=function(bx,bw,bz){var bv=true;switch(bw){case ar.Clipper.NodeType.ntOpen:return;case ar.Clipper.NodeType.ntClosed:bv=!bx.IsOpen;break;default:break}if(bx.m_polygon.length>0&&bv){bz.push(bx.m_polygon)}for(var bu=0,bt=bx.Childs(),by=bt.length,bs=bt[bu];bu<by;bu++,bs=bt[bu]){ar.Clipper.AddPolyNodeToPaths(bs,bw,bz)}};ar.Clipper.OpenPathsFromPolyTree=function(bt){var bs=new ar.Paths();for(var bv=0,bu=bt.ChildCount();bv<bu;bv++){if(bt.Childs()[bv].IsOpen){bs.push(bt.Childs()[bv].m_polygon)}}return bs};ar.Clipper.ClosedPathsFromPolyTree=function(bt){var bs=new ar.Paths();ar.Clipper.AddPolyNodeToPaths(bt,ar.Clipper.NodeType.ntClosed,bs);return bs};bj(ar.Clipper,ar.ClipperBase);ar.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2};ar.ClipperOffset=function(bs,bt){if(typeof(bs)=="undefined"){bs=2}if(typeof(bt)=="undefined"){bt=ar.ClipperOffset.def_arc_tolerance}this.m_destPolys=new ar.Paths();this.m_srcPoly=new ar.Path();this.m_destPoly=new ar.Path();this.m_normals=new Array();this.m_delta=0;this.m_sinA=0;this.m_sin=0;this.m_cos=0;this.m_miterLim=0;this.m_StepsPerRad=0;this.m_lowest=new ar.IntPoint();this.m_polyNodes=new ar.PolyNode();this.MiterLimit=bs;this.ArcTolerance=bt;this.m_lowest.X=-1};ar.ClipperOffset.two_pi=6.28318530717959;ar.ClipperOffset.def_arc_tolerance=0.25;ar.ClipperOffset.prototype.Clear=function(){ar.Clear(this.m_polyNodes.Childs());this.m_lowest.X=-1};ar.ClipperOffset.Round=ar.Clipper.Round;ar.ClipperOffset.prototype.AddPath=function(bA,by,bz){var bw=bA.length-1;if(bw<0){return}var bx=new ar.PolyNode();bx.m_jointype=by;bx.m_endtype=bz;if(bz==ar.EndType.etClosedLine||bz==ar.EndType.etClosedPolygon){while(bw>0&&ar.IntPoint.op_Equality(bA[0],bA[bw])){bw--}}bx.m_polygon.push(bA[0]);var bt=0,bs=0;for(var bu=1;bu<=bw;bu++){if(ar.IntPoint.op_Inequality(bx.m_polygon[bt],bA[bu])){bt++;bx.m_polygon.push(bA[bu]);if(bA[bu].Y>bx.m_polygon[bs].Y||(bA[bu].Y==bx.m_polygon[bs].Y&&bA[bu].X<bx.m_polygon[bs].X)){bs=bt}}}if(bz==ar.EndType.etClosedPolygon&&bt<2){return}this.m_polyNodes.AddChild(bx);if(bz!=ar.EndType.etClosedPolygon){return}if(this.m_lowest.X<0){this.m_lowest=new ar.IntPoint(0,bs)}else{var bv=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y];if(bx.m_polygon[bs].Y>bv.Y||(bx.m_polygon[bs].Y==bv.Y&&bx.m_polygon[bs].X<bv.X)){this.m_lowest=new ar.IntPoint(this.m_polyNodes.ChildCount()-1,bs)}}};ar.ClipperOffset.prototype.AddPaths=function(bv,bu,bw){for(var bt=0,bs=bv.length;bt<bs;bt++){this.AddPath(bv[bt],bu,bw)}};ar.ClipperOffset.prototype.FixOrientations=function(){if(this.m_lowest.X>=0&&!ar.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon)){for(var bs=0;bs<this.m_polyNodes.ChildCount();bs++){var bt=this.m_polyNodes.Childs()[bs];if(bt.m_endtype==ar.EndType.etClosedPolygon||(bt.m_endtype==ar.EndType.etClosedLine&&ar.Clipper.Orientation(bt.m_polygon))){bt.m_polygon.reverse()}}}else{for(var bs=0;bs<this.m_polyNodes.ChildCount();bs++){var bt=this.m_polyNodes.Childs()[bs];if(bt.m_endtype==ar.EndType.etClosedLine&&!ar.Clipper.Orientation(bt.m_polygon)){bt.m_polygon.reverse()}}}};ar.ClipperOffset.GetUnitNormal=function(bw,bv){var bt=(bv.X-bw.X);var bs=(bv.Y-bw.Y);if((bt==0)&&(bs==0)){return new ar.DoublePoint(0,0)}var bu=1/Math.sqrt(bt*bt+bs*bs);bt*=bu;bs*=bu;return new ar.DoublePoint(bs,-bt)};ar.ClipperOffset.prototype.DoOffset=function(bE){this.m_destPolys=new Array();this.m_delta=bE;if(ar.ClipperBase.near_zero(bE)){for(var bz=0;bz<this.m_polyNodes.ChildCount();bz++){var bw=this.m_polyNodes.Childs()[bz];if(bw.m_endtype==ar.EndType.etClosedPolygon){this.m_destPolys.push(bw.m_polygon)}}return}if(this.MiterLimit>2){this.m_miterLim=2/(this.MiterLimit*this.MiterLimit)}else{this.m_miterLim=0.5}var bB;if(this.ArcTolerance<=0){bB=ar.ClipperOffset.def_arc_tolerance}else{if(this.ArcTolerance>Math.abs(bE)*ar.ClipperOffset.def_arc_tolerance){bB=Math.abs(bE)*ar.ClipperOffset.def_arc_tolerance}else{bB=this.ArcTolerance}}var bC=3.14159265358979/Math.acos(1-bB/Math.abs(bE));this.m_sin=Math.sin(ar.ClipperOffset.two_pi/bC);this.m_cos=Math.cos(ar.ClipperOffset.two_pi/bC);this.m_StepsPerRad=bC/ar.ClipperOffset.two_pi;if(bE<0){this.m_sin=-this.m_sin}for(var bz=0;bz<this.m_polyNodes.ChildCount();bz++){var bw=this.m_polyNodes.Childs()[bz];this.m_srcPoly=bw.m_polygon;var bA=this.m_srcPoly.length;if(bA==0||(bE<=0&&(bA<3||bw.m_endtype!=ar.EndType.etClosedPolygon))){continue}this.m_destPoly=new Array();if(bA==1){if(bw.m_jointype==ar.JoinType.jtRound){var bt=1,bs=0;for(var by=1;by<=bC;by++){this.m_destPoly.push(new ar.IntPoint(ar.ClipperOffset.Round(this.m_srcPoly[0].X+bt*bE),ar.ClipperOffset.Round(this.m_srcPoly[0].Y+bs*bE)));var bv=bt;bt=bt*this.m_cos-this.m_sin*bs;bs=bv*this.m_sin+bs*this.m_cos}}else{var bt=-1,bs=-1;for(var by=0;by<4;++by){this.m_destPoly.push(new ar.IntPoint(ar.ClipperOffset.Round(this.m_srcPoly[0].X+bt*bE),ar.ClipperOffset.Round(this.m_srcPoly[0].Y+bs*bE)));if(bt<0){bt=1}else{if(bs<0){bs=1}else{bt=-1}}}}this.m_destPolys.push(this.m_destPoly);continue}this.m_normals.length=0;for(var by=0;by<bA-1;by++){this.m_normals.push(ar.ClipperOffset.GetUnitNormal(this.m_srcPoly[by],this.m_srcPoly[by+1]))}if(bw.m_endtype==ar.EndType.etClosedLine||bw.m_endtype==ar.EndType.etClosedPolygon){this.m_normals.push(ar.ClipperOffset.GetUnitNormal(this.m_srcPoly[bA-1],this.m_srcPoly[0]))}else{this.m_normals.push(new ar.DoublePoint(this.m_normals[bA-2]))}if(bw.m_endtype==ar.EndType.etClosedPolygon){var bx=bA-1;for(var by=0;by<bA;by++){bx=this.OffsetPoint(by,bx,bw.m_jointype)}this.m_destPolys.push(this.m_destPoly)}else{if(bw.m_endtype==ar.EndType.etClosedLine){var bx=bA-1;for(var by=0;by<bA;by++){bx=this.OffsetPoint(by,bx,bw.m_jointype)}this.m_destPolys.push(this.m_destPoly);this.m_destPoly=new Array();var bu=this.m_normals[bA-1];for(var by=bA-1;by>0;by--){this.m_normals[by]=new ar.DoublePoint(-this.m_normals[by-1].X,-this.m_normals[by-1].Y)}this.m_normals[0]=new ar.DoublePoint(-bu.X,-bu.Y);bx=0;for(var by=bA-1;by>=0;by--){bx=this.OffsetPoint(by,bx,bw.m_jointype)}this.m_destPolys.push(this.m_destPoly)}else{var bx=0;for(var by=1;by<bA-1;++by){bx=this.OffsetPoint(by,bx,bw.m_jointype)}var bD;if(bw.m_endtype==ar.EndType.etOpenButt){var by=bA-1;bD=new ar.IntPoint(ar.ClipperOffset.Round(this.m_srcPoly[by].X+this.m_normals[by].X*bE),ar.ClipperOffset.Round(this.m_srcPoly[by].Y+this.m_normals[by].Y*bE));this.m_destPoly.push(bD);bD=new ar.IntPoint(ar.ClipperOffset.Round(this.m_srcPoly[by].X-this.m_normals[by].X*bE),ar.ClipperOffset.Round(this.m_srcPoly[by].Y-this.m_normals[by].Y*bE));this.m_destPoly.push(bD)}else{var by=bA-1;bx=bA-2;this.m_sinA=0;this.m_normals[by]=new ar.DoublePoint(-this.m_normals[by].X,-this.m_normals[by].Y);if(bw.m_endtype==ar.EndType.etOpenSquare){this.DoSquare(by,bx)}else{this.DoRound(by,bx)}}for(var by=bA-1;by>0;by--){this.m_normals[by]=new ar.DoublePoint(-this.m_normals[by-1].X,-this.m_normals[by-1].Y)}this.m_normals[0]=new ar.DoublePoint(-this.m_normals[1].X,-this.m_normals[1].Y);bx=bA-1;for(var by=bx-1;by>0;--by){bx=this.OffsetPoint(by,bx,bw.m_jointype)}if(bw.m_endtype==ar.EndType.etOpenButt){bD=new ar.IntPoint(ar.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*bE),ar.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*bE));this.m_destPoly.push(bD);bD=new ar.IntPoint(ar.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*bE),ar.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*bE));this.m_destPoly.push(bD)}else{bx=1;this.m_sinA=0;if(bw.m_endtype==ar.EndType.etOpenSquare){this.DoSquare(0,1)}else{this.DoRound(0,1)}}this.m_destPolys.push(this.m_destPoly)}}}};ar.ClipperOffset.prototype.Execute=function(){var by=arguments,bu=by[0] instanceof ar.PolyTree;if(!bu){var bw=by[0],bz=by[1];ar.Clear(bw);this.FixOrientations();this.DoOffset(bz);var bx=new ar.Clipper(0);bx.AddPaths(this.m_destPolys,ar.PolyType.ptSubject,true);if(bz>0){bx.Execute(ar.ClipType.ctUnion,bw,ar.PolyFillType.pftPositive,ar.PolyFillType.pftPositive)}else{var bs=ar.Clipper.GetBounds(this.m_destPolys);var bA=new ar.Path();bA.push(new ar.IntPoint(bs.left-10,bs.bottom+10));bA.push(new ar.IntPoint(bs.right+10,bs.bottom+10));bA.push(new ar.IntPoint(bs.right+10,bs.top-10));bA.push(new ar.IntPoint(bs.left-10,bs.top-10));bx.AddPath(bA,ar.PolyType.ptSubject,true);bx.ReverseSolution=true;bx.Execute(ar.ClipType.ctUnion,bw,ar.PolyFillType.pftNegative,ar.PolyFillType.pftNegative);if(bw.length>0){bw.splice(0,1)}}}else{var bw=by[0],bz=by[1];bw.Clear();this.FixOrientations();this.DoOffset(bz);var bx=new ar.Clipper(0);bx.AddPaths(this.m_destPolys,ar.PolyType.ptSubject,true);if(bz>0){bx.Execute(ar.ClipType.ctUnion,bw,ar.PolyFillType.pftPositive,ar.PolyFillType.pftPositive)}else{var bs=ar.Clipper.GetBounds(this.m_destPolys);var bA=new ar.Path();bA.push(new ar.IntPoint(bs.left-10,bs.bottom+10));bA.push(new ar.IntPoint(bs.right+10,bs.bottom+10));bA.push(new ar.IntPoint(bs.right+10,bs.top-10));bA.push(new ar.IntPoint(bs.left-10,bs.top-10));bx.AddPath(bA,ar.PolyType.ptSubject,true);bx.ReverseSolution=true;bx.Execute(ar.ClipType.ctUnion,bw,ar.PolyFillType.pftNegative,ar.PolyFillType.pftNegative);if(bw.ChildCount()==1&&bw.Childs()[0].ChildCount()>0){var bv=bw.Childs()[0];bw.Childs()[0]=bv.Childs()[0];for(var bt=1;bt<bv.ChildCount();bt++){bw.AddChild(bv.Childs()[bt])}}else{bw.Clear()}}}};ar.ClipperOffset.prototype.OffsetPoint=function(bu,bt,bs){this.m_sinA=(this.m_normals[bt].X*this.m_normals[bu].Y-this.m_normals[bu].X*this.m_normals[bt].Y);if(Math.abs(this.m_sinA*this.m_delta)<1){var bw=(this.m_normals[bt].X*this.m_normals[bu].X+this.m_normals[bu].Y*this.m_normals[bt].Y);if(bw>0){this.m_destPoly.push(new ar.IntPoint(ar.ClipperOffset.Round(this.m_srcPoly[bu].X+this.m_normals[bt].X*this.m_delta),ar.ClipperOffset.Round(this.m_srcPoly[bu].Y+this.m_normals[bt].Y*this.m_delta)));return bt}}else{if(this.m_sinA>1){this.m_sinA=1}else{if(this.m_sinA<-1){this.m_sinA=-1}}}if(this.m_sinA*this.m_delta<0){this.m_destPoly.push(new ar.IntPoint(ar.ClipperOffset.Round(this.m_srcPoly[bu].X+this.m_normals[bt].X*this.m_delta),ar.ClipperOffset.Round(this.m_srcPoly[bu].Y+this.m_normals[bt].Y*this.m_delta)));this.m_destPoly.push(new ar.IntPoint(this.m_srcPoly[bu]));this.m_destPoly.push(new ar.IntPoint(ar.ClipperOffset.Round(this.m_srcPoly[bu].X+this.m_normals[bu].X*this.m_delta),ar.ClipperOffset.Round(this.m_srcPoly[bu].Y+this.m_normals[bu].Y*this.m_delta)))}else{switch(bs){case ar.JoinType.jtMiter:var bv=1+(this.m_normals[bu].X*this.m_normals[bt].X+this.m_normals[bu].Y*this.m_normals[bt].Y);if(bv>=this.m_miterLim){this.DoMiter(bu,bt,bv)}else{this.DoSquare(bu,bt)}break;case ar.JoinType.jtSquare:this.DoSquare(bu,bt);break;case ar.JoinType.jtRound:this.DoRound(bu,bt);break}}bt=bu;return bt};ar.ClipperOffset.prototype.DoSquare=function(bu,bt){var bs=Math.tan(Math.atan2(this.m_sinA,this.m_normals[bt].X*this.m_normals[bu].X+this.m_normals[bt].Y*this.m_normals[bu].Y)/4);this.m_destPoly.push(new ar.IntPoint(ar.ClipperOffset.Round(this.m_srcPoly[bu].X+this.m_delta*(this.m_normals[bt].X-this.m_normals[bt].Y*bs)),ar.ClipperOffset.Round(this.m_srcPoly[bu].Y+this.m_delta*(this.m_normals[bt].Y+this.m_normals[bt].X*bs))));this.m_destPoly.push(new ar.IntPoint(ar.ClipperOffset.Round(this.m_srcPoly[bu].X+this.m_delta*(this.m_normals[bu].X+this.m_normals[bu].Y*bs)),ar.ClipperOffset.Round(this.m_srcPoly[bu].Y+this.m_delta*(this.m_normals[bu].Y-this.m_normals[bu].X*bs))))};ar.ClipperOffset.prototype.DoMiter=function(bt,bs,bu){var bv=this.m_delta/bu;this.m_destPoly.push(new ar.IntPoint(ar.ClipperOffset.Round(this.m_srcPoly[bt].X+(this.m_normals[bs].X+this.m_normals[bt].X)*bv),ar.ClipperOffset.Round(this.m_srcPoly[bt].Y+(this.m_normals[bs].Y+this.m_normals[bt].Y)*bv)))};ar.ClipperOffset.prototype.DoRound=function(bv,bu){var bs=Math.atan2(this.m_sinA,this.m_normals[bu].X*this.m_normals[bv].X+this.m_normals[bu].Y*this.m_normals[bv].Y);var bt=ar.Cast_Int32(ar.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(bs)));var bz=this.m_normals[bu].X,by=this.m_normals[bu].Y,bx;for(var bw=0;bw<bt;++bw){this.m_destPoly.push(new ar.IntPoint(ar.ClipperOffset.Round(this.m_srcPoly[bv].X+bz*this.m_delta),ar.ClipperOffset.Round(this.m_srcPoly[bv].Y+by*this.m_delta)));bx=bz;bz=bz*this.m_cos-this.m_sin*by;by=bx*this.m_sin+by*this.m_cos}this.m_destPoly.push(new ar.IntPoint(ar.ClipperOffset.Round(this.m_srcPoly[bv].X+this.m_normals[bv].X*this.m_delta),ar.ClipperOffset.Round(this.m_srcPoly[bv].Y+this.m_normals[bv].Y*this.m_delta)))};ar.Error=function(bt){try{throw new Error(bt)}catch(bs){alert(bs.message)}};ar.JS={};ar.JS.AreaOfPolygon=function(bs,bt){if(!bt){bt=1}return ar.Clipper.Area(bs)/(bt*bt)};ar.JS.AreaOfPolygons=function(bu,bv){if(!bv){bv=1}var bt=0;for(var bs=0;bs<bu.length;bs++){bt+=ar.Clipper.Area(bu[bs])}return bt/(bv*bv)};ar.JS.BoundsOfPath=function(bs,bt){return ar.JS.BoundsOfPaths([bs],bt)};ar.JS.BoundsOfPaths=function(bu,bt){if(!bt){bt=1}var bs=ar.Clipper.GetBounds(bu);bs.left/=bt;bs.bottom/=bt;bs.right/=bt;bs.top/=bt;return bs};ar.JS.Clean=function(bC,bD){if(!(bC instanceof Array)){return[]}var bu=bC[0] instanceof Array;var bC=ar.JS.Clone(bC);if(typeof bD!="number"||bD===null){ar.Error("Delta is not a number in Clean().");return bC}if(bC.length===0||(bC.length==1&&bC[0].length===0)||bD<0){return bC}if(!bu){bC=[bC]}var bz=bC.length;var bA,bs,bE,bB,bt,bw,by;var bx=[];for(var bv=0;bv<bz;bv++){bs=bC[bv];bA=bs.length;if(bA===0){continue}else{if(bA<3){bE=bs;bx.push(bE);continue}}bE=bs;bB=bD*bD;bt=bs[0];bw=1;for(by=1;by<bA;by++){if((bs[by].X-bt.X)*(bs[by].X-bt.X)+(bs[by].Y-bt.Y)*(bs[by].Y-bt.Y)<=bB){continue}bE[bw]=bs[by];bt=bs[by];bw++}bt=bs[bw-1];if((bs[0].X-bt.X)*(bs[0].X-bt.X)+(bs[0].Y-bt.Y)*(bs[0].Y-bt.Y)<=bB){bw--}if(bw<bA){bE.splice(bw,bA-bw)}if(bE.length){bx.push(bE)}}if(!bu&&bx.length){bx=bx[0]}else{if(!bu&&bx.length===0){bx=[]}else{if(bu&&bx.length===0){bx=[[]]}}}return bx};ar.JS.Clone=function(bx){if(!(bx instanceof Array)){return[]}if(bx.length===0){return[]}else{if(bx.length==1&&bx[0].length===0){return[[]]}}var bz=bx[0] instanceof Array;if(!bz){bx=[bx]}var bt=bx.length,by,bw,bu,bs;var bv=new Array(bt);for(bw=0;bw<bt;bw++){by=bx[bw].length;bs=new Array(by);for(bu=0;bu<by;bu++){bs[bu]={X:bx[bw][bu].X,Y:bx[bw][bu].Y}}bv[bw]=bs}if(!bz){bv=bv[0]}return bv};ar.JS.Lighten=function(bA,bK){if(!(bA instanceof Array)){return[]}if(typeof bK!="number"||bK===null){ar.Error("Tolerance is not a number in Lighten().");return ar.JS.Clone(bA)}if(bA.length===0||(bA.length==1&&bA[0].length===0)||bK<0){return ar.JS.Clone(bA)}if(!(bA[0] instanceof Array)){bA=[bA]}var bI,bH,bu,bG,bB,bz,bD,bC,bv,bM,bt,bs;var bx,bN,bF,by,bw;var bJ=bA.length;var bL=bK*bK;var bE=[];for(bI=0;bI<bJ;bI++){bu=bA[bI];bz=bu.length;if(bz==0){continue}for(bG=0;bG<1000000;bG++){bB=[];bz=bu.length;if(bu[bz-1].X!=bu[0].X||bu[bz-1].Y!=bu[0].Y){bs=1;bu.push({X:bu[0].X,Y:bu[0].Y});bz=bu.length}else{bs=0}bt=[];for(bH=0;bH<bz-2;bH++){bD=bu[bH];bv=bu[bH+1];bC=bu[bH+2];by=bD.X;bw=bD.Y;bx=bC.X-by;bN=bC.Y-bw;if(bx!==0||bN!==0){bF=((bv.X-by)*bx+(bv.Y-bw)*bN)/(bx*bx+bN*bN);if(bF>1){by=bC.X;bw=bC.Y}else{if(bF>0){by+=bx*bF;bw+=bN*bF}}}bx=bv.X-by;bN=bv.Y-bw;bM=bx*bx+bN*bN;if(bM<=bL){bt[bH+1]=1;bH++}}bB.push({X:bu[0].X,Y:bu[0].Y});for(bH=1;bH<bz-1;bH++){if(!bt[bH]){bB.push({X:bu[bH].X,Y:bu[bH].Y})}}bB.push({X:bu[bz-1].X,Y:bu[bz-1].Y});if(bs){bu.pop()}if(!bt.length){break}else{bu=bB}}bz=bB.length;if(bB[bz-1].X==bB[0].X&&bB[bz-1].Y==bB[0].Y){bB.pop()}if(bB.length>2){bE.push(bB)}}if(!bA[0] instanceof Array){bE=bE[0]}if(typeof(bE)=="undefined"){bE=[[]]}return bE};ar.JS.PerimeterOfPath=function(bD,bw,bu){if(typeof(bD)=="undefined"){return 0}var bB=Math.sqrt;var bz=0;var bC,bA,bt=0,bs=0,by=0,bx=0;var bv=bD.length;if(bv<2){return 0}if(bw){bD[bv]=bD[0];bv++}while(--bv){bC=bD[bv];bt=bC.X;bs=bC.Y;bA=bD[bv-1];by=bA.X;bx=bA.Y;bz+=bB((bt-by)*(bt-by)+(bs-bx)*(bs-bx))}if(bw){bD.pop()}return bz/bu};ar.JS.PerimeterOfPaths=function(bw,bt,bv){if(!bv){bv=1}var bs=0;for(var bu=0;bu<bw.length;bu++){bs+=ar.JS.PerimeterOfPath(bw[bu],bt,bv)}return bs};ar.JS.ScaleDownPath=function(bu,bv){var bs,bt;if(!bv){bv=1}bs=bu.length;while(bs--){bt=bu[bs];bt.X=bt.X/bv;bt.Y=bt.Y/bv}};ar.JS.ScaleDownPaths=function(bx,bw){var bu,bt,bv,bs=Math.round;if(!bw){bw=1}bu=bx.length;while(bu--){bt=bx[bu].length;while(bt--){bv=bx[bu][bt];bv.X=bv.X/bw;bv.Y=bv.Y/bw}}};ar.JS.ScaleUpPath=function(bv,bw){var bt,bu,bs=Math.round;if(!bw){bw=1}bt=bv.length;while(bt--){bu=bv[bt];bu.X=bs(bu.X*bw);bu.Y=bs(bu.Y*bw)}};ar.JS.ScaleUpPaths=function(bx,bw){var bu,bt,bv,bs=Math.round;if(!bw){bw=1}bu=bx.length;while(bu--){bt=bx[bu].length;while(bt--){bv=bx[bu][bt];bv.X=bs(bv.X*bw);bv.Y=bs(bv.Y*bw)}}};ar.ExPolygons=function(){return[]};ar.ExPolygon=function(){this.outer=null;this.holes=null};ar.JS.AddOuterPolyNodeToExPolygons=function(bs,bw){var bC=new ar.ExPolygon();bC.outer=bs.Contour();var bz=bs.Childs();var bt=bz.length;bC.holes=new Array(bt);var bv,bu,by,bx,bB,bA;for(by=0;by<bt;by++){bv=bz[by];bC.holes[by]=bv.Contour();for(bx=0,bB=bv.Childs(),bA=bB.length;bx<bA;bx++){bu=bB[bx];ar.JS.AddOuterPolyNodeToExPolygons(bu,bw)}}bw.push(bC)};ar.JS.ExPolygonsToPaths=function(bt){var bs,bv,bw,bu;var bx=new ar.Paths();for(bs=0,bw=bt.length;bs<bw;bs++){bx.push(bt[bs].outer);for(bv=0,bu=bt[bs].holes.length;bv<bu;bv++){bx.push(bt[bs].holes[bv])}}return bx};ar.JS.PolyTreeToExPolygons=function(bs){var bt=new ar.ExPolygons();var bw,bv,bx,bu;for(bv=0,bx=bs.Childs(),bu=bx.length;bv<bu;bv++){bw=bx[bv];ar.JS.AddOuterPolyNodeToExPolygons(bw,bt)}return bt}})();